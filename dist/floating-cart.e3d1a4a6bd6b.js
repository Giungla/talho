"use strict";(()=>{(function(){let d="oculto",p="talho_cart_items",nt="mensagemdeerro",at="disabled",x="carrinhoflutuante--visible",y="X-Talho-Session",C="__Host-Talho-Session-Cookie",it=[],T="https://xef5-44zo-gegm.b2.xano.io/api:79PnTkh_",ut={headers:{Accept:"application/json","Content-Type":"application/json"}},h=new Intl.NumberFormat("pt-BR",{currency:"BRL",style:"currency"}),N={cart:null,fetched:null,isPending:!1,isCartOpened:!0},a=new Proxy(N,{get(t,e){switch(e){case"hasFreeShipping":return(t.cart?.order_price??0)>400;case"missingForFreeShipping":return Math.max(0,400-(t.cart?.order_price??0));case"getOrderPrice":return h.format(t.cart?.order_price??0);default:return Reflect.get(t,e)}},set(t,e,r){let n=Reflect.set(t,e,r);if(!n)return n;switch(e){case"isPending":break;case"isCartOpened":v();break;case"cart":G(),B(),localStorage.setItem(p,JSON.stringify(r));break}return n}}),_=o("[data-wtf-floating-cart-item]"),m=o("[data-wtf-floating-cart-item-wrapper]"),H=o("[data-wtf-floating-cart-empty-cart]"),R=o("[data-wtf-promo-valid]"),A=o("[data-wtf-promo-invalid]"),F=o("[data-wtf-floating-cart-total]");function L(t=[],e="GET"){let r=new Headers({Accept:"application/json","Content-Type":"application/json"});for(let[s,f]of t)r.set(s,f);let n=K(C);return n&&r.set(y,n),{method:e,headers:r}}function O(t,e,r={}){if(t.length===0)throw new Error("'setCookie' should receive a valid cookie name");if(!["string","number","boolean"].includes(typeof e)||e.toString().length===0)throw new Error("'setCookie' should receive a valid cookie value");let n=[`${t}=${e}`];r?.expires&&r?.expires instanceof Date&&n.push("expires="+r.expires.toUTCString()),r?.sameSite&&typeof r?.sameSite=="string"&&n.push(`SameSite=${r?.sameSite}`),r?.path&&n.push(`path=${r?.path}`),r?.domain&&n.push(`domain=${r?.path}`),r?.maxAge&&n.push(`maxAge=${r.maxAge}`),r?.httpOnly&&n.push("HttpOnly"),r?.secure&&n.push("Secure");let s=n.join("; ");return document.cookie=s,s}function K(t){let e=document.cookie.split("; ").find(r=>{let{name:n}=w(r);return n===t});return e?w(e).value:!1}function w(t){let[e,r]=t.split("=");return{name:e,value:r}}function i(t,e,r){return Object.prototype.hasOwnProperty.call(t,e)&&(!r||typeof t[e]===r)}function b(t){return Array.isArray(t)}function P(t){if(typeof t!="string")return null;try{return JSON.parse(t)}catch{return null}}function o(t,e=document){return e?e.querySelector(t):null}function U(t,e,r,n){if(t)return t.addEventListener(e,r,n),()=>t.removeEventListener(e,r,n)}function dt(t,e,r){t&&t.setAttribute(e,r)}function lt(t,e){t&&t.removeAttribute(e)}function c(t,e){t&&(t.textContent=e)}function D(t,e){return t?t.classList.contains(e):!1}function ft(t,...e){t&&t.classList.add(...e)}function pt(t,...e){t&&t.classList.remove(...e)}function l(t,e,r){return t?t.classList.toggle(e,r):!1}function g(t){return t.length}function M(t){return 86400*1e3*t}function E(t){let e=this?.get(y);return e&&O(C,e,{path:"/",secure:!0,sameSite:"Strict",maxAge:M(90)}),{message:t,succeeded:!1}}function I(t){let e=this?.get(y);return e&&O(C,e,{path:"/",secure:!0,sameSite:"Strict",maxAge:M(90)}),{data:t,succeeded:!0}}function q(t){return!i(t,"order_price","number")||!i(t,"items")||!b(t.items)?!1:g(t.items)===0?!0:t.items.every(e=>i(e,"name","string")&&i(e,"quantity","number")&&i(e,"price","number")&&i(e,"imageUrl","string")&&i(e,"sku_id","number")&&i(e,"slug","string"))}async function v(){if(!a.isCartOpened)return;let t=P(localStorage.getItem(p));if(t&&q(t)){a.fetched??=!0,a.cart=t;return}else localStorage.removeItem(p);a.isPending=!0;let e=await j();a.fetched??=!0,a.isPending=!1,e.succeeded&&(a.cart=e.data)}async function j(){let t="Houve uma falha ao buscar o seu carrinho";try{let e=await fetch(`${T}/cart/get`,{...L()});if(!e.ok){let n=await e.json();return E(n?.message??t)}let r=await e.json();return I(r)}catch{return E(t)}}async function V(t,e){let r="Houve uma falha ao buscar o seu carrinho";try{let n=await fetch(`${T}/cart/handle`,{...L([],"POST"),body:JSON.stringify({item:t,operation:e})});if(!n.ok){let f=await n.json();return E(f?.message??r)}let s=await n.json();return I(s)}catch{return E(r)}}async function $(t,e){if(a.isPending)return;a.isPending=!0;let r=await V({...e,quantity:1},t);a.isPending=!1,r.succeeded&&(a.cart=r.data)}function G(){if(c(F,a.getOrderPrice),!b(a.cart?.items)||!_||!m)return;if(l(o("[data-wtf-floating-cart-total-block]"),d,g(a.cart?.items)===0),l(o("[data-wtf-floating-cart-checkout-button]",S),d,g(a.cart?.items)===0),!l(H,d,g(a.cart?.items)>0))return c(o("[data-wtf-floating-cart-items-indicator]"),"0"),m.replaceChildren();let t=0,e=document.createDocumentFragment();for(let{slug:r,imageUrl:n,quantity:s,price:f,sku_id:Y,name:z}of a.cart.items){t+=s;let u=_.cloneNode(!0);c(o("[data-wtf-floating-cart-item-product-name]",u),z),c(o("[data-wtf-floating-cart-item-quantity]",u),s.toString()),c(o("[data-wtf-floating-cart-item-product-price]",u),h.format(f));let k=o("[data-wtf-floating-cart-item-image]",u);k&&(k.style.backgroundImage=`url('${n}')`);let W={sku_id:Y,reference_id:r},X=[["delete","data-wtf-floating-cart-item-remove"],["increase","data-wtf-floating-cart-item-plus-button"],["decrease","data-wtf-floating-cart-item-minus-button"]];for(let[Z,tt]of X)U(o(`[${tt}]`,u),"click",et=>J.call(et,Z,W));e.appendChild(u)}c(o("[data-wtf-floating-cart-items-indicator]"),t.toString()),m?.replaceChildren(e)}function B(){let{hasFreeShipping:t}=a;return l(R,d,!t),l(A,d,t),t?c(o("[data-wtf-promo-validada-txt-sem-imagem]",R),"Voc\xEA ganhou frete gr\xE1tis"):c(o("[data-wtf-promo-invalidada-txt]",A),`Adicione mais ${h.format(a.missingForFreeShipping)} e ganhe frete gr\xE1tis`)}async function J(t,e){this.preventDefault(),this.stopPropagation(),await $(t,e)}let S=o("[data-wtf-floating-cart]"),Q=new MutationObserver(t=>{let e=t[0].target,r=D(e,x);a.isCartOpened=r,window.scrollTo({top:0,behavior:"instant"}),document.body.style.overflow=r?"hidden":"unset"});S&&(Q.observe(S,{attributes:!0,attributeFilter:["class"]}),m&&(window.addEventListener("storage",function(t){t.key===p&&(a.cart=t.newValue?P(t.newValue):null)}),v().then(()=>{a.isCartOpened=!1})))})();})();
