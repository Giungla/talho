"use strict";(()=>{(function(){let y="disabled",d="oculto",V="talho_cart_items",W="carrinhoflutuante--visible",X="__Host-Talho-AuthToken",L="https://xef5-44zo-gegm.b2.xano.io",Y=`${L}/api:79PnTkh_`,P=new Intl.NumberFormat("pt-BR",{currency:"BRL",style:"currency"}),E=new Set;function C(e){return JSON.stringify(e)}function O(e,t,r){return e.split(t,r)}function _(...e){return Math.max(...e)}function Q(e){let t=O(document.cookie,"; ").find(r=>{let{name:n}=H(r);return n===e});return t?H(t).value:!1}function H(e){let[t,r]=O(e,"=");return{name:t,value:r}}let x=Q(X),k={Accept:"application/json","Content-Type":"application/json"},N={...k,Authorization:x};if(!x){location.href="/acessos/entrar";return}let F=new Proxy({list:[]},{get(e,t){let r=Z(e.list);switch(t){case"hasOrders":return r>0;case"ordersCount":return r;default:return e[t]}},set(e,t,r){let n=Reflect.set(e,t,r);if(!n)return n;switch(t){case"list":se();break}return!0}});function c(e,t){e&&(e.textContent=t)}function K(e,...t){e&&e.classList.add(...t)}function g(e,...t){e&&e.classList.remove(...t)}function q(e,t,r){return e?e.classList.toggle(t,r):!1}function h(e,t){e&&e.removeAttribute(t)}function D(e,t,r){e&&e.setAttribute(t,r)}function pe(e){return Array.isArray(e)}function a(e,t=document){return t?t.querySelector(e):null}function R(e,t,r,n){if(e)return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r,n)}function Z(e){return e.length}function A(e){return{data:e,succeeded:!0}}function m(e){return{message:e,succeeded:!1}}async function ee(){let e="Falha ao buscar os pedidos";try{let t=await fetch(`${L}/api:TJEuMepe/user/orders`,{headers:N});if(!t.ok){let n=await t.json();return m(n?.message??e)}let r=await t.json();return A(r)}catch{return m(e)}}async function te({comment:e,rating:t,product_id:r}){let n="Falha ao gerar a avalia\xE7\xE3o, tente novamente mais tarde.";try{let o=await fetch(`${L}/api:9ixgU7Er/ratings/${r}/create`,{method:"POST",headers:N,body:C({rating:t,comment:e})});if(!o.ok){let u=await o.json();return m(u?.message??n)}let T=await o.json();return A(T)}catch{return m(n)}}async function re(e){let t="Falha ao adicionar o produto";try{let r=await fetch(`${Y}/cart/handle`,{method:"POST",headers:k,credentials:"include",body:C({item:e,operation:"add"})});if(!r.ok){let o=await r.json();return m(o?.message??t)}let n=await r.json();return A(n)}catch{return m(`[CATCH] ${t}`)}}function p(e,...t){e&&e.replaceChildren(...t.filter(Boolean))}function l(e){if(e)return e.remove()}let ne=a("[data-wtf-has-no-orders]"),I=a("[data-wtf-order-template]"),v=a("[data-wtf-orders-container]"),M=a("[data-wtf-product-item]",v),S=a("[data-wtf-evaluated]"),j=a("[data-wtf-not-rated]"),U=a("[data-wtf-evaluation-form]");for(let e of[S,j,U,M])l(e);function ae(){return document.createDocumentFragment()}async function oe({sku_id:e,slug:t}){if(E.has(t))return;E.add(t);let r=await re({sku_id:e,quantity:1,reference_id:t});if(!r.succeeded){E.delete(t);return}K(a("#carrinho-flutuante"),W),localStorage.setItem(V,C(r.data)),E.delete(t)}function se(){let{list:e,hasOrders:t}=F;if(!v||!I||!M)return;q(ne,d,t),q(v,d,!t);let r=ae();for(let n of e){let o=I.cloneNode(!0);c(a("[data-wtf-order-total]",o),n.total),c(a("[data-wtf-order-status]",o),n.status),c(a("[data-wtf-created-at]",o),n.created_at),c(a("[data-wtf-payment-method]",o),n.payment_method),c(a("[data-wtf-transaction-id]",o),n.transaction_id);let T=a("[data-wtf-product-list]",o);for(let{name:u,slug:i,product_id:w,sku_id:ue,quantity:de,unit_price:$,image:Te,review:b,has_stock:le}of n.order_items){let f=M.cloneNode(!0),z=a("[data-wtf-review-area]",f);D(a("[data-wtf-product-anchor]",f),"href",`/produtos/${i}`);let G=a("[data-wtf-buy-again-cta]",f);if(le?R(G,"click",()=>oe({sku_id:ue,slug:i})):l(G),c(a("[data-wtf-product-name]",f),u),c(a("[data-wtf-product-price]",f),P.format($/100)),c(a("[data-wtf-product-subtotal]",f),P.format($*de/100)),b===void 0){let s=j?.cloneNode(!0)??null,J=U?.cloneNode(!0)??null;g(s,d),n.pago?(R(a("[data-wtf-not-rated-cta]",s),"click",()=>{ie(w,s,J)},{once:!0}),l(a("[data-wtf-not-rated-unpaid]",s))):(l(a("[data-wtf-not-rated-paid]",s)),l(a("[data-wtf-not-rated-cta]",s))),p(z,s,J)}else{let s=S?.cloneNode(!0);c(a("[data-wtf-evaluated-comment]",s),b.comment),B(s,b.rating),g(s,d),p(z,s)}T.insertAdjacentElement("afterbegin",f)}r.appendChild(o)}p(v,r)}function B(e,t){if(!e)return;let r=a("[data-wtf-evaluated-star-section]",e);if(!r)return;let n=_(r.childElementCount-_(1,t),0);for(let o=0;o++<n;)l(r.lastElementChild)}function ie(e,t,r){if(!t||!r)return;K(t,d),g(r,d);let n=a("form",r),o=n?.parentElement;if(!n||!o)return;let T=["id","name","method","data-name","aria-label","data-wf-page-id","data-wf-element-id","data-turnstile-sitekey"];for(let i of T)h(n,i);l(n),p(o),o.insertAdjacentHTML("afterbegin",n.outerHTML);let u=a("form",r);h(a('[type="submit"]',u),y),R(u,"submit",async i=>{if(i.preventDefault(),i.stopPropagation(),!i.isTrusted||!i.submitter)return;D(i.submitter,y,y);let w=await te({product_id:e,comment:u.comment.value,rating:parseInt(u.rating.value)});if(!w.succeeded){h(i.submitter,y);return}ce(w.data,u)})}function ce(e,t){if(!t)return;let r=t.closest("[data-wtf-review-area]");if(!r)return;let n=S?.cloneNode(!0);n&&(B(n,e.rating),c(a("[data-wtf-evaluated-comment]",n),e.comment),g(n,d),p(r,n))}ee().then(e=>{e.succeeded&&(F.list=e.data)})})();})();
