!function(){"use strict";var e="__Host-Talho-Session-Cookie",t="X-Talho-Session";function r(r){const o=r?.headers.get(t);o&&function(e,t,r={}){if(0===a(e))throw new Error("'setCookie' should receive a valid cookie name");if(!["string","number","boolean"].includes(typeof t)||0===a(t.toString()))throw new Error("'setCookie' should receive a valid cookie value");const o=[`${e}=${t}`];c(r?.expires&&r?.expires instanceof Date,o,"expires="+r.expires.toUTCString()),c(r.maxAge,o,`maxAge=${r.maxAge}`),c(r?.sameSite&&"string"==typeof r?.sameSite,o,`SameSite=${r?.sameSite}`),c(r?.path,o,`path=${r?.path}`),c(r?.domain,o,`domain=${r?.domain}`),c(r?.httpOnly,o,"HttpOnly"),c(r?.secure,o,"Secure");const s=o.join(d);document.cookie=s}(e,o,{path:"/",secure:!0,sameSite:"Strict",expires:new Date(Date.now()+1e3*h*14)})}function o(e,t=!1){return r(this),t||this&&401===this.status&&(location.href=function(e,t={}){const r=new URL(`${location.protocol}//${location.hostname}`),o=new URL(e,r);for(const[s,n]of Object.entries(t))o.searchParams.set(s,n);return o.toString()}("/acessos/entrar",{redirect_to:encodeURIComponent(location.pathname+location.search)})),{message:e,succeeded:!1}}function s(e){return r(this),{data:e,succeeded:!0}}function n(r=[],o="GET"){const s="application/json",n=new Headers({Accept:s,"Content-Type":s});for(const[e,t]of r)n.set(e,t);const i=u(e);i&&n.set(t,i);const a=u("__Host-Talho-AuthToken");return a&&n.set("Authorization",a),{method:o,headers:n}}var i=null;function a(e){return e.length}function c(e,t,r){return e?t.push(r):-1}var d="; ";function u(e){const t=document.cookie.split(d).find(t=>{const{name:r}=p(t);return r===e});return!!t&&p(t).value}function p(e){const[t,r]=e.split("=");return{name:t,value:r}}var h=86400;new Event("input"),new Event("blur");var{createApp:l}=Vue,m="transactionid",f="pix",_="creditcard",g={[f]:"PIX",[_]:"Cartão de crédito"},y="https://xef5-44zo-gegm.b2.xano.io/api:YomXpzWs";l({name:"TalhoOrderNoteApp",data:()=>({order:i,prepare_status:i,prepareMessage:i}),async created(){const e=new URLSearchParams(location.search).get(m);if(!e)return;const t=await this.getOrder(e);t.succeeded&&(this.order=t.data,this.prepare_status=t.data.order.prepare_status)},methods:{async getOrder(e){const t="Não foi possível encontrar o pedido";try{const r=await fetch(`${y}/order/delivery-prepare?${m}=${e}`,{...n()});if(!r.ok){const e=await r.json();return o.call(r,e?.message??t)}const i=await r.json();return s.call(r,i)}catch(r){return o(t)}},async handleOrderStatus(){const e=this.order,{prepare_status:t}=this;if(!e||!t)return;const r=await this.setOrderStatus(e.order.number,t);this.prepareMessage=r.succeeded?"Modificado com sucesso":r.message},async setOrderStatus(e,t){const r="Não foi possível alterar o status de preparação";try{const a=await fetch(`${y}/order/delivery-status`,{...n([],"PATCH"),body:(i={order_id:e,prepare_status:t},JSON.stringify(i))});if(!a.ok){const e=await a.json();return o.call(a,e?.message??r)}const c=await a.json();return s.call(a,c)}catch(a){return o(r)}var i},printPage(){window.print()}},computed:{company(){return this.order?.company??i},customer(){return this.order?.customer??i},items(){return this.order?.items??i},itemsCount(){return a(this.items??[])},cOrder(){if(!this.order)return i;const{date:e,time:t,total:r,number:o,shipping:s,subtotal:n,discounts:a,change_for:c,notes_short:d,observations:u,payment_method:p,has_free_shipping:h}=this.order.order;return{date:e,time:t,total:r,number:o,shipping:s,subtotal:n,discounts:a,change_for:c,notes_short:d,observations:u,has_free_shipping:h,payment_method:g?.[p]}},deliveryDate(){if(!this.order)return i;const{order:e}=this.order;return`${e.delivery_date} ${e.delivery_hour}`},priorityTax(){const e=this.order?.order;return e&&e.has_priority?e?.priority_price:i},subsidyDiscount(){const e=this.order?.order;return e&&e.has_subsidy?e?.subsidy_price:i},pixDiscount(){const e=this.order?.order;return e&&"pix"===e.payment_method?{discountPrice:e.pix_discount_price,discountPercentual:e.pix_discount_percentual}:i},hasPaid(){return this.order?.order.paid??!1},deliveredAt(){return this.order?.order.delivered_at??i}}}).mount("#note-order"),window.addEventListener("pageshow",e=>{e.persisted&&window.location.reload()})}();