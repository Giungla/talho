(function(){'use strict';var H=401,d="__Host-Talho-AuthToken",f="__Host-Talho-Session-Cookie",h="X-Talho-Session";function U(e){!e||e.status!==H||(location.href=i("/acessos/entrar",{redirect_to:encodeURIComponent(location.pathname+location.search)}));}function b(e){let r=e?.headers.get(h);r&&x(f,r,{path:"/",secure:true,sameSite:"Strict",expires:new Date(Date.now()+g(90))});}function u(e){return b(this),U(this),{message:e,succeeded:false}}function m(e){return b(this),{data:e,succeeded:true}}function E(e=[],r="GET"){let t=new Headers({Accept:"application/json","Content-Type":"application/json"});for(let[p,k]of e)t.set(p,k);let o=a(f);o&&t.set(h,o);let n=a(d);return n&&t.set("Authorization",n),{method:r,headers:t}}var s=null,v="oculto";function c(e,r=document){return r?r.querySelector(e):s}function S(e,r,t){e&&e.setAttribute(r,t);}function T(e,r){return e?e.getAttribute(r):s}function I(e,r,t){return e?e.classList.toggle(r,t):false}function A(e){return I(c("[data-wtf-loader]"),v,true)}function i(e,r={}){let t=new URL(`${location.protocol}//${location.hostname}`),o=new URL(e,t);for(let[n,p]of Object.entries(r))o.searchParams.set(n,p);return o.toString()}function R(e){if(typeof e!="string")return null;try{return JSON.parse(e)}catch{return s}}function l(e){return e.length}function _(e){return e===s}var O="; ";function a(e){let r=document.cookie.split(O).find(t=>{let{name:o}=y(t);return o===e});return r?y(r).value:false}function y(e){let[r,t]=e.split("=");return {name:r,value:t}}function x(e,r,t={}){if(l(e)===0)throw new Error("'setCookie' should receive a valid cookie name");if(!["string","number","boolean"].includes(typeof r)||l(r.toString())===0)throw new Error("'setCookie' should receive a valid cookie value");let o=[`${e}=${r}`];t?.expires&&t?.expires instanceof Date&&o.push("expires="+t.expires.toUTCString()),t.maxAge&&o.push(`maxAge=${t.maxAge}`),t?.sameSite&&typeof t?.sameSite=="string"&&o.push(`SameSite=${t?.sameSite}`),t?.path&&o.push(`path=${t?.path}`),t?.domain&&o.push(`domain=${t?.path}`),t?.httpOnly&&o.push("HttpOnly"),t?.secure&&o.push("Secure");let n=o.join(O);return document.cookie=n,n}function g(e){return 86400*1e3*e}var P=new Intl.NumberFormat("pt-BR",{currency:"BRL",style:"currency"});var N="",M="https://xef5-44zo-gegm.b2.xano.io";var{createApp:K}=window.Vue,L="00:00:00",w=`${M}/api:5lp3Lw8X`,D="/pagamento/confirmacao-do-pedido",F=K({name:"PIXProcessPage",setup(){return {hasEventSource:Vue.shallowRef(s)}},data(){return {now:Date.now(),isLoading:true,hasCopied:false,order:s,nowInterval:s}},async created(){this.hasEventSource="EventSource"in window;let r=new URLSearchParams(location.search).get("order");if(!r){location.href=i("/");return}let t=await this.getOrder(r);if(!t.succeeded||t.data.payment_method!=="pix"){location.href=i("/");return}if(this.isLoading=false,this.order=t.data,this.setQRImage(),t.data.pago){setTimeout(()=>{location.href=i(D,{order:r});},5e3);return}if(!t.data.expired&&(this.nowInterval=setInterval(()=>this.now=Date.now(),1e3),this.hasEventSource))return this.pollOrder(r)},methods:{pollOrder(e){let r=new EventSource(`${w}/confirm-pix/${e}`);r.addEventListener("message",async t=>{let o=R(t.data);_(o)||(this.patchOrder({...o,expired:L===this.timmer||o.expired}),(this.hasPaid||this.isExpired)&&(r.readyState!==r.CLOSED&&r.close(),this.clearInterval()),this.hasPaid&&setTimeout(()=>{location.href=i(D,{order:e});},5e3));}),document.addEventListener("beforeunload",()=>{r.readyState!==r.CLOSED&&(r.close(),this.clearInterval());});},patchOrder({pago:e,expired:r,total:t}){this.order&&(this.order.pago=e,this.order.total=t,this.order.expired=r);},async getOrder(e){let r="Falha ao capturar o pedido";try{let t=await fetch(`${w}/confirm-pix/${e}/rest`,{...E()});if(!t.ok){let n=await t.json();return u.call(t,n?.message??r)}let o=await t.json();return m.call(t,o)}catch{return u(r)}},async handleCopyQRCode(){if(!this.hasCopied){if(this.hasCopied=true,navigator.clipboard.writeText)await navigator.clipboard.writeText(this.order?.qrcode_text??"");else {let e=document.createElement("input");document.body.appendChild(e),e.value=this.order?.qrcode_text??"",e.select(),document.execCommand("copy"),document.body.removeChild(e);}setTimeout(()=>this.hasCopied=false,3e3);}},setQRImage(){let e=c("[data-wtf-qr-code-image]");e&&(e.onload=()=>A(),S(e,"src",this.order?.qrcode??T(e,"src")));},clearInterval(){clearInterval(this.nowInterval),this.nowInterval=s;}},computed:{orderPrice(){let{order:e}=this;return P.format(e?e.total/100:0)},timmer(){if(!this.order||this.isExpired)return L;let e=Math.floor(Math.max((this.order?.due_time??0)-this.now,0)/1e3),r=Math.floor(e/3600),t=Math.floor(e%3600/60),o=e%60;return [r,t,o].map(n=>n.toString().padStart(2,"0")).join(":")},hasPaid(){return this.order?.pago??false},isExpired(){return this.order?.expired??false},getQRCode(){return this.order?.qrcode_text??N}},watch:{timmer(e){e===L&&this.patchOrder({expired:true,total:this.order?.total??0,pago:this.order?.pago??false});}}});F.mount(c("#pixProcess"));
})();