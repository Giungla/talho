(()=>{var e=window.Vue.createApp;let r=null,a="00:00:00",o="https://xef5-44zo-gegm.b2.xano.io/api:5lp3Lw8X",t=new Intl.NumberFormat("pt-BR",{currency:"BRL",style:"currency"});function i(e,t){var r,a,o=new URL(location.protocol+"//"+location.hostname),i=new URL(e,o);for([r,a]of Object.entries(t))i.searchParams.set(r,a);return i.toString()}function d(e,t=document){return t?t.querySelector(e):r}function s(e){return{message:e,succeeded:!1}}e({name:"PIXProcessPage",setup(){},data(){return{now:Date.now(),hasCopied:!1,order:r,nowInterval:r}},async created(){var e;let t=new URLSearchParams(location.search).get("order");t?(e=await this.getOrder(t)).succeeded&&(this.order=e.data,this.setQRImage(),e.data.pago&&setTimeout(()=>{location.href=i("/pagamento/confirmacao-do-pedido",{order:t})},5e3),e.data.expired||e.data.pago||(this.nowInterval=setInterval(()=>this.now=Date.now(),1e3),this.pollOrder(t))):location.href="/"},methods:{pollOrder(t){let r=new EventSource(o+"/confirm-pix/"+t);r.addEventListener("message",async e=>{e=JSON.parse(e.data);this.patchOrder({...e,expired:a===this.timmer||e.expired}),(this.hasPaid||this.isExpired)&&(r.readyState!==r.CLOSED&&r.close(),this.clearInterval()),this.hasPaid&&setTimeout(()=>{location.href=i("/pagamento/confirmacao-do-pedido",{order:t})},5e3)}),document.addEventListener("beforeunload",()=>{r.readyState!==r.CLOSED&&(r.close(),this.clearInterval())})},patchOrder({pago:e,expired:t,total:r}){this.order&&(this.order.pago=e,this.order.total=r,this.order.expired=t)},async getOrder(e){var t="Falha ao capturar o pedido";try{var r=await fetch(o+`/confirm-pix/${e}/rest`,{headers:{Accept:"application/json"}});return r.ok?{data:await r.json(),succeeded:!0}:s((await r.json())?.message??t)}catch(e){return s(t)}},async handleCopyQRCode(){var e;this.hasCopied||(this.hasCopied=!0,navigator.clipboard.writeText?await navigator.clipboard.writeText(this.order?.qrcode_text??""):(e=document.createElement("input"),document.body.appendChild(e),e.value=this.order?.qrcode_text??"",e.select(),document.execCommand("copy"),document.body.removeChild(e)),setTimeout(()=>this.hasCopied=!1,3e3))},setQRImage(){var e=d("[data-wtf-qr-code-image]");e&&e.setAttribute("src",this.order?.qrcode??e.getAttribute("src"))},clearInterval(){clearInterval(this.nowInterval),this.nowInterval=r}},computed:{orderPrice(){return t.format(this.order?.total??0)},timmer(){var e;return!this.order||this.isExpired?a:(e=Math.floor(Math.max((this.order?.due_time??0)-this.now,0)/1e3),[Math.floor(e/3600),Math.floor(e%3600/60),e%60].map(e=>e.toString().padStart(2,"0")).join(":"))},hasPaid(){return this.order?.pago??!1},isExpired(){return this.order?.expired??!1},getQRCode(){return this.order?.qrcode_text??""}},watch:{timmer(e){e===a&&this.patchOrder({expired:!0,total:this.order?.total??0,pago:this.order?.pago??!1})}}}).mount(d("#pixProcess"))})();