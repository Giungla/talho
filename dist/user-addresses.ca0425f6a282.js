"use strict";(()=>{(function(){let L="__Host-Talho-AuthToken",g="oculto",S="https://xef5-44zo-gegm.b2.xano.io",X="[data-wtf-wrapper]",B="mensagemdeerro",N="#wf-form-Address-Form";if(!J()){location.href=`/acessos/entrar?redirect_to=${encodeURIComponent(location.pathname)}`;return}let Y=["AL","AM","AP","CE","BA","AC","DF","ES","GO","MA","MG","MS","MT","PA","PB","PE","PI","PR","RJ","RN","RO","RR","RS","SC","SE","SP","TO"];function b(e){y(r("[data-wtf-loader]"),g,!e)}function r(e,t=document){return t.querySelector(e)}function w(e,t,n,s){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n,s)}function _(e){let t=document.cookie.split("; ").find(n=>{let{name:s}=k(n);return s===e});return t?k(t).value:!1}function k(e){let[t,n]=e.split("=");return{name:t,value:n}}function J(){return _(L)!==!1}function Q(e,...t){e.classList.add(...t)}function ee(e,...t){e.classList.remove(...t)}function y(e,t,n){e.classList.toggle(t,n)}function O(e,t){e.removeAttribute(t)}function M(e){return{data:e,succeeded:!0}}function c(e){return{message:e,succeeded:!1}}let I={Accept:"application/json","Content-Type":"application/json",Authorization:_(L)},H=r("[data-wtf-error-message-no-address-registered]"),R=r("[data-wtf-registered-address]"),te=R?.parentElement;R?.remove();let P=new Proxy([],{set(e,t,n){let s=Reflect.set(e,t,n),a=t==="length"&&n===0;if(x(a),a||typeof n=="number")return s;let d=r(`[data-wtf-address-id="${n.id}"]`)!==null;return x(i(e)>0),d||ne(n),s}});function x(e){H&&y(H,g,!e)}function ne(e){if(!R)return;let t=R.cloneNode(!0),n=r("[data-wtf-address-tag]",t),s=r("[data-wtf-address]",t),a=r("[data-wtf-delete-user-address]",t);if(n&&(n.textContent=e.nick),s&&(s.textContent=e.address),a){let d=null;d=w(a,"click",async function(){if(!(await ae(e.id)).succeeded)return;d?.();let pe=P.findIndex(Ee=>Ee.id===e.id);P.splice(pe,1),t.remove()},!1)}t.dataset.wtfAddressId=e.id,te.appendChild(t)}async function se(e){let t="O CEP informado n\xE3o foi encontrado";try{let n=await fetch(`${S}/api:jyidAW68/cepaddress/${e}`);if(!n.ok){let a=await n.json();return c(a?.message??t)}let s=await n.json();return M(s)}catch{return c(t)}}async function re(){let e="Houve uma falha ao buscar os seus endere\xE7os. Tente novamente mais tarde.";try{let t=await fetch(`${S}/api:Yytq8Zut/user_addresses/all`,{headers:I});if(!t.ok){let s=await t.json();return c(s?.message??e)}let n=await t.json();return M(n)}catch{return c(e)}}async function ae(e){let t="Houve uma falha ao remover o endere\xE7o. Tente novamente mais tarde.";try{let n=await fetch(`${S}/api:Yytq8Zut/user_addresses/${e}/delete`,{method:"DELETE",headers:I});if(!n.ok){let s=await n.json();return c(s?.message??t)}return M(null)}catch{return c(t)}}async function oe(e){let t="Houve uma falha ao salvar o endere\xE7o. Por favor, tente novamente mais tarde.";try{let n=await fetch(`${S}/api:Yytq8Zut/user_addresses/create`,{method:"POST",headers:I,body:JSON.stringify(e)});if(!n.ok){let a=await n.json();return c(a?.message??t)}let s=await n.json();return M(s)}catch{return c(t)}}function l(e){return function(t){return[e,t]}}function ie(e,t){let n=!t.succeeded,s=r("[data-wtf-error-new]",e),a=r("[data-wtf-success-new]",e);if(s&&y(s,g,!n),a&&y(a,g,n),!n){setTimeout(()=>a&&Q(a,g),8e3);return}let d=s&&r("div",s);d&&(d.textContent=t.message)}function i(e){return e.length}function de(e){return e.closest(X)}function u(e,t){let n=de(e);n&&y(n,B,!t)}function ce(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function ue(e){if(e.succeeded){let{cep:t,logradouro:n,localidade:s,complemento:a,bairro:d,uf:G}=e.data;v(o,t),v(f,n),v(m,d),v(p,s),v(E,G);return}for(let t of[f,j,m,p,E])v(t)}function D(e){if(Array.isArray(e)){P.push(...e);return}P.push(e)}function v(e,t=""){e&&(e.value=t)}let A=r(N);if(!A)return;let le=["name","method","data-name","aria-label","data-wf-page-id","data-wf-element-id","data-turnstile-sitekey"];for(let e of le)O(A,e);let U=r('input[type="submit"]',A);U&&O(U,"disabled");let F=A.parentElement;if(!F)return;ee(F,"w-form"),A.remove(),F.insertAdjacentHTML("afterbegin",A.outerHTML);let h=r(N);if(!h)return;let T=r("[data-wtf-tag-new]"),o=r("[data-wtf-zipcode-new]"),f=r("[data-wtf-address-new]"),C=r("[data-wtf-number-new]"),j=r("[data-wtf-complement-new]"),m=r("[data-wtf-neighborhood-new]"),p=r("[data-wtf-city-new]"),E=r("[data-wtf-state-new]");function fe(){if(!o)return;let e=o.value.replace(/\D+/g,""),t=i(e);o.value=t>5?e.replace(/(\d{5})(\d{1,3})/,"$1-$2"):e,!(i(o.value)<9)&&se(e).then(ue)}function K(){let e=l("wtfTagNew");if(!T)return e(!1);let t=i(T.value)>2;return u(T,t),e(t)}function $(){let e=l("wtfZipcodeNew");if(!o)return e(!1);let t=/^\d{5}-\d{3}$/.test(o.value);return u(o,t),e(t)}function V(){let e=l("wtfAddressNew");if(!f)return e(!1);let t=i(f.value)>2;return u(f,t),e(t)}function q(){let e=l("wtfNumberNew");if(!C)return e(!1);let t=i(C.value)>0;return u(C,t),e(t)}function z(){let e=l("wtfNeighborhoodNew");if(!m)return e(!1);let t=i(m.value)>2;return u(m,t),e(t)}function W(){let e=l("wtfCityNew");if(!p)return e(!1);let t=i(p.value)>2;return u(p,t),e(t)}function Z(){let e=l("wtfStateNew");if(!E)return e(!1);let t=Y.includes(E.value);return u(E,t),e(t)}let me=[{field:T,validator:K},{field:o,validator:$},{field:f,validator:V},{field:C,validator:q},{field:m,validator:z},{field:p,validator:W},{field:E,validator:Z}];for(let{field:e,validator:t}of me)e&&(w(e,"blur",t,!1),w(e,"input",function(){u(e,!0)},!1));o&&w(o,"input",fe,!1),w(h,"submit",async function(e){e.preventDefault(),e.stopPropagation();let n=[K,$,V,q,z,W,Z].find(a=>!a().at(1));if(n){let a=`[data-${ce(n().at(0))}]`;r(a,h)?.focus({preventScroll:!1});return}b(!0);let s=await oe({nick:T?.value,cep:o?.value,address:f?.value,number:C?.value,complement:j?.value,neighborhood:m?.value,city:p?.value,state:E?.value});if(ie(h,s),!s.succeeded)return b(!1);h.reset(),D(s.data),b(!1)},!1),re().then(e=>{e.succeeded&&i(e.data)>0&&D(e.data)}).finally(()=>b(!1))})();})();
