!function(){"use strict";var e="COMPLETED";function t(e){const t=o((n=document.cookie,n.replace(/\s{2,}/g," ")),"; ").find(t=>{const{name:n}=r(t);return n===e});var n;return!!t&&r(t).value}function r(e){const[t,...r]=o(e,"=");return{name:t,value:a(r)>0&&decodeURIComponent(r.join("="))}}var n=null;function a(e){return e.length}function o(e,t,r){return e.split(t,r)}function s(e){return e===n}var i="__Host-Talho-Session-Cookie",c="X-Talho-Session",u={redirect_to:encodeURIComponent(location.pathname+location.search)},d={path:"/",secure:!0,sameSite:"Strict",expires:new Date(Date.now()+12096e5)};function l(e){const t=e?.headers.get(c);t&&function(e,t,r={}){if(0===a(e))throw new Error("'setCookie' should receive a valid cookie name");if(!["string","number","boolean"].includes(typeof t)||0===a(t.toString()))throw new Error("'setCookie' should receive a valid cookie value");const n=[`${e}=${encodeURIComponent(t)}`];g(r?.expires&&r?.expires instanceof Date,n,"expires="+r.expires?.toUTCString()),g(r.maxAge,n,`maxAge=${r.maxAge}`),g(r?.sameSite&&"string"==typeof r?.sameSite,n,`SameSite=${r?.sameSite}`),g(r?.path,n,`path=${r?.path}`),g(r?.domain,n,`domain=${r?.domain}`),g(r?.httpOnly,n,"HttpOnly"),g(r?.secure,n,"Secure");const o=n.join("; ");document.cookie=o}(i,t,d)}function h(e,t=!1,r){return l(this),t||this&&401===this.status&&function(e="/acessos/entrar",t=u){location.href=function(e,t={}){const r=new URL(`${location.protocol}//${location.hostname}`),n=new URL(e,r);for(const[a,o]of Object.entries(t))n.searchParams.set(a,o);return n.toString()}(e,t)}(),r?.(),{message:e,succeeded:!1}}function m(e,t){return l(this),t?.(),{data:e,succeeded:!0}}function p(e=[],r="GET"){const n="application/json",a=new Headers({Accept:n,"Content-Type":n});for(const[t,i]of e)a.set(t,i);const o=t(i);o&&a.set(c,o);const s=t("__Host-Talho-AuthToken");return s&&a.set("Authorization",s),{method:r,headers:a}}var f=new Intl.NumberFormat("pt-BR",{currency:"BRL",style:"currency"});function g(e,t,r){return e?t.push(r):-1}new Event("input"),new Event("blur"),document.currentScript?.getAttribute("data-parameter-names");var{nextTick:w,createApp:v}=Vue,y=v({name:"OrderManagementApp",async created(){this.refreshURLState=function(e,t,r){const a=(o=function(e){return new URL(window.location.href).searchParams.get(e)}(e))?function(e){if("string"!=typeof e)return null;try{return JSON.parse(e)}catch{return n}}(decodeURIComponent(atob(o))):null;var o;return a!==n&&r(a),()=>{const r=function(e){return btoa(encodeURIComponent(function(e){return JSON.stringify(e)}(e)))}(t()),a=function(e,t){const r=new URL(window.location.href);return t?r.searchParams.set(e,t):r.searchParams.delete(e),r.pathname+r.search}(e,r);history.replaceState(n,"",a)}}("filter",()=>this.filter,e=>this.filter=e),this.refresh(!1)},data:()=>({startDate:n,orders:n,availableFilters:[{label:"Não iniciado",name:"NOTSTARTED"},{label:"Em preparação",name:"PREPARING"},{label:"Preparado",name:"PREPARED"},{label:"Pronto para entrega",name:"DELIVERYREADY"},{label:"Pedido entregue",name:e}],refreshURLState:n,filter:{page:1,status:n}}),methods:{async getOrders(){const e="Houve uma falha com a busca de pedidos";try{const t=await fetch(`https://xef5-44zo-gegm.b2.xano.io/api:YomXpzWs/order/list${this.getFilteringQueryParams}`,{...p()});if(!t.ok){const r=await t.json();return h.call(t,r?.message??e)}const r=await t.json();return m.call(t,r)}catch(t){return h(e)}},getFilterByToken(e){return this.getAppliableFilters.find(({name:t})=>t===e)},async refresh(e=!0){const t=await this.getOrders();t.succeeded&&(this.orders=t.data,await w(()=>{var t,r;r={block:"start",behavior:"smooth"},(t=P)&&t.scrollIntoView(r),e&&this.refreshURLState?.()}))},async handlePaginate(e){this.filter.page=e,this.refresh()},async handleStatus(e){this.filter={...this.filter,page:1,status:e},this.refresh()}},computed:{hasOrders(){const{orders:e}=this,t=e?.itemsReceived;return"number"==typeof t&&t>0},getParsedOrders(){return this.hasOrders?this.orders?.items.map(({total:t,transaction_id:r,created_at:n,order_items:a,prepare_status:o,status:s,...i})=>{const c=s===e?s:o;return{...i,created_date:(u=n,new Date(u).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),items_count:a,price:f.format(t/100),url:`/adm/ficha-de-pedido?transactionid=${r}`,...c&&{delivery_status:this.getFilterByToken(c)}};var u}):[]},getAppliableFilters(){return this.availableFilters.map(({name:e,...t})=>({...t,name:e,className:e?.toLowerCase()}),[])},hasPrevPage(){return this.orders?.prevPage!==n},hasNextPage(){return this.orders?.nextPage!==n},hasLastPage(){const e=this.orders;return t=[e?.nextPage,e?.curPage],r=e?.pageTotal,t.includes(r);var t,r},hasFirstPage(){const e=this.orders?.curPage;return"number"==typeof e&&e>2},getFilteringQueryParams(){const e=this.filter,t=[];for(const[r,n]of Object.entries(e))switch(r){case"page":g(!0,t,[r,n].join("="));break;case"status":g(!s(n),t,[r,n].join("="))}return"?"+t.join("&")}}}),P=function(e,t=document){return t?t.querySelector(e):n}("#order-management-list");y.mount(P),window.addEventListener("pageshow",e=>{e.persisted&&window.location.reload()})}();