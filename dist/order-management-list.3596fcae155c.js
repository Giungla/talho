!function(){"use strict";var e="COMPLETED",t="CANCELED";function r(e,t={},r="pt-BR"){return new Date(e).toLocaleDateString(r,{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",...t})}var n="__Host-Talho-Session-Cookie",a="X-Talho-Session",s={redirect_to:encodeURIComponent(location.pathname+location.search)},i={path:"/",secure:!0,sameSite:"Strict",expires:new Date(Date.now()+12096e5)};function o(e){const t=e?.headers.get(a);t&&function(e,t,r={}){if(0===v(e))throw new Error("'setCookie' should receive a valid cookie name");if(!["string","number","boolean"].includes(typeof t)||0===v(t.toString()))throw new Error("'setCookie' should receive a valid cookie value");const n=[`${e}=${encodeURIComponent(t)}`];l(r?.expires&&r?.expires instanceof Date,n,"expires="+r.expires?.toUTCString()),l(r.maxAge,n,`maxAge=${r.maxAge}`),l(r?.sameSite&&"string"==typeof r?.sameSite,n,`SameSite=${r?.sameSite}`),l(r?.path,n,`path=${r?.path}`),l(r?.domain,n,`domain=${r?.domain}`),l(r?.httpOnly,n,"HttpOnly"),l(r?.secure,n,"Secure");const a=n.join(g);document.cookie=a}(n,t,i)}function c(e,t=!1,r){return o(this),t||this&&401===this.status&&function(e="/acessos/entrar",t=s){location.href=function(e,t={}){const r=new URL(`${location.protocol}//${location.hostname}`),n=new URL(e,r);for(const[a,s]of Object.entries(t))n.searchParams.set(a,s);return n.toString()}(e,t)}(),r?.(),{message:e,succeeded:!1}}function u(e,t){return o(this),t?.(),{data:e,succeeded:!0}}function d(e=[],t="GET"){const r="application/json",s=new Headers({Accept:r,"Content-Type":r});for(const[n,a]of e)s.set(n,a);const i=p(n);i&&s.set(a,i);const o=p("__Host-Talho-AuthToken");return o&&s.set("Authorization",o),{method:t,headers:s}}var h=new Intl.NumberFormat("pt-BR",{currency:"BRL",style:"currency"});function l(e,t,r){return e?t.push(r):-1}function f(e,t){return e.includes(t)}var m=new WeakMap;new Event("input"),new Event("blur"),document.currentScript?.getAttribute("data-parameter-names");var g="; ";function p(e){const t=y((r=document.cookie,r.replace(/\s{2,}/g," ")),g).find(t=>{const{name:r}=w(t);return r===e});var r;return!!t&&w(t).value}function w(e){const[t,...r]=y(e,"=");return{name:t,value:v(r)>0&&decodeURIComponent(r.join("="))}}var D=null;function v(e){return e.length}function y(e,t,r){return e.split(t,r)}function P(e){return e===D}var{nextTick:b,createApp:R}=Vue;function S(e){return!e||0===v(e)}function L(e){return S(e)?D:function(e,t={}){return new Date(e).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit",...t})}(e,E)}function T(e){return S(e)?D:e}var E={timeZone:"UTC"};function k(e){return y(new Date(e-108e5).toISOString(),"T").at(0)??D}var A=R({name:"OrderManagementApp",async created(){this.refreshURLState=function(e,t,r){const n=(a=function(e){return new URL(window.location.href).searchParams.get(e)}(e))?function(e){if("string"!=typeof e)return null;try{return JSON.parse(e)}catch{return D}}(decodeURIComponent(atob(a))):null;var a;return n!==D&&r(n),()=>{const r=function(e){return btoa(encodeURIComponent(function(e){return JSON.stringify(e)}(e)))}(t()),n=function(e,t){const r=new URL(window.location.href);return t?r.searchParams.set(e,t):r.searchParams.delete(e),r.pathname+r.search}(e,r);history.replaceState(D,"",n)}}("filter",()=>this.filter,e=>this.filter=e),this.refresh(!1).then(this.resetFilterDates).then(()=>{setTimeout(()=>{location.href=location.protocol.concat("//",location.hostname,location.pathname)},18e5)})},data:()=>({orders:D,availableFilters:[{label:"Não iniciado",name:"NOTSTARTED"},{label:"Em preparação",name:"PREPARING"},{label:"Preparado",name:"PREPARED"},{label:"Pronto para entrega",name:"DELIVERYREADY"},{label:"Pedido entregue",name:e},{label:"Pedido em análise",name:t}],refreshURLState:D,filter:{page:1,status:D,endDate:D,startDate:D}}),methods:{async getOrders(){const e="Houve uma falha com a busca de pedidos";try{const t=await fetch(`https://xef5-44zo-gegm.b2.xano.io/api:YomXpzWs/order/list${this.getFilteringQueryParams}`,{...d()});if(!t.ok){const r=await t.json();return c.call(t,r?.message??e)}const r=await t.json();return u.call(t,r)}catch(t){return c(e)}},getFilterByToken(e){return this.getAppliableFilters.find(t=>t.name===e)},async refresh(e=!0){const t=await this.getOrders();t.succeeded&&(this.orders=t.data,await b(()=>{var t,r;r={block:"start",behavior:"smooth"},(t=O)&&t.scrollIntoView(r),e&&this.refreshURLState?.()}))},async handlePaginate(e){this.filter.page=e,this.refresh()},async handleStatus(e){this.filter={...this.filter,page:1,status:e},this.refresh()},resetFilterDates(){const{newest:e,oldest:t}=this.getLimits;this.filter.startDate??=t,this.filter.endDate??=e},handleResetDates(){this.filter={...this.filter,page:1,endDate:D,startDate:D},this.resetFilterDates(),this.refresh()}},computed:{hasOrders(){const{orders:e}=this,t=e?.itemsReceived;return"number"==typeof t&&t>0},getParsedOrders(){return this.hasOrders?this.orders?.items.map(({total:n,transaction_id:a,created_at:s,order_items:i,prepare_status:o,status:c,...u})=>{const d=f([e,t],c)?c:o;return{...u,created_date:r(s),items_count:i,price:h.format(n/100),url:`/adm/ficha-de-pedido?transactionid=${a}`,...d&&{delivery_status:this.getFilterByToken(d)},delivery_date:y(u.date,"-").reverse().join("/").concat(` às ${u.hour}hrs`)}}):[]},getAppliableFilters(){return this.availableFilters.map(({name:e,...t})=>({...t,name:e,className:e?.toLowerCase()}),[])},hasPrevPage(){return!P(this.orders?.prevPage)},hasNextPage(){return!P(this.orders?.nextPage)},hasLastPage(){const e=this.orders;return f([e?.nextPage,e?.curPage],e?.pageTotal)},hasFirstPage(){const e=this.orders?.curPage;return"number"==typeof e&&e>2},getFilteringQueryParams(){const e=this.filter,t=[];for(const[r,n]of Object.entries(e))switch(r){case"page":l(!0,t,[r,n].join("="));break;case"status":l(!P(n),t,[r,n].join("="));break;case"endDate":l(!S(n),t,["final_date",n].join("="));break;case"startDate":l(!S(n),t,["start_date",n].join("="))}return"?"+t.join("&")},endDate:{get(){return L(this.filter.endDate)},set(e){this.filter.endDate=T(e);const{endDate:t}=this.filter;P(t)&&(this.filter.endDate=this.getLimits.newest),this.hasReversedDates?this.filter.startDate=this.getLimits.oldest:this.handlePaginate(1)}},startDate:{get(){return L(this.filter.startDate)},set(e){this.filter.startDate=T(e);const{startDate:t}=this.filter;P(t)&&(this.filter.startDate=this.getLimits.oldest),this.hasReversedDates?this.filter.endDate=this.getLimits.newest:this.handlePaginate(1)}},hasReversedDates(){const{endDate:e,startDate:t}=this.filter;if(S(e)||S(t))return!1;const r=new Date(`${e}T23:59:59`);return new Date(`${t}T00:00:00`).getTime()>r.getTime()},getLimits(){const e=this.orders;if(P(e))return{oldest:D,newest:D};const{oldest:t,newest:r}=e.dateLimits;return{oldest:k(t),newest:k(r)}}},directives:{showPickerOnFocus:{mounted(e){const t=function(e,t,r,n){if(e)return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r,n)}(e,"focus",()=>{try{e.showPicker()}catch(t){}});m.set(e,t)},unmounted:e=>{const t=m.get(e);t&&(t(),m.delete(e))}}}}),O=function(e,t=document){return t?t.querySelector(e):D}("#order-management-list");A.mount(O),window.addEventListener("pageshow",e=>{e.persisted&&window.location.reload()})}();