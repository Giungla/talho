(()=>{var e=window.Vue.createApp;let a=null,o="00:00:00",i="https://xef5-44zo-gegm.b2.xano.io/api:5lp3Lw8X",t=new Intl.NumberFormat("pt-BR",{currency:"BRL",style:"currency"});function d(e,t={}){var r,a,o=new URL(location.protocol+"//"+location.hostname),i=new URL(e,o);for([r,a]of Object.entries(t))i.searchParams.set(r,a);return i.toString()}function n(e,t=document){return t?t.querySelector(e):a}function s(e){return{message:e,succeeded:!1}}e({name:"PIXProcessPage",setup(){},data(){return{now:Date.now(),hasCopied:!1,order:a,nowInterval:a}},async created(){let e=new URLSearchParams(location.search).get("order");if(e){var t=await this.getOrder(e);if(t.succeeded&&"pix"===t.data.payment_method){if(this.order=t.data,this.setQRImage(),t.data.pago)setTimeout(()=>{location.href=d("/pagamento/confirmacao-do-pedido",{order:e})},5e3);else if(!t.data.expired)return this.nowInterval=setInterval(()=>this.now=Date.now(),1e3),"EventSource"in window?this.pollOrder(e):void 0}else location.href=d("/")}else location.href="/"},methods:{pollOrder(t){let r=new EventSource(i+"/confirm-pix/"+t);r.addEventListener("message",async e=>{e=(e=>{if("string"!=typeof e)return null;try{return JSON.parse(e)}catch{return a}})(e.data);e!==a&&(this.patchOrder({...e,expired:o===this.timmer||e.expired}),(this.hasPaid||this.isExpired)&&(r.readyState!==r.CLOSED&&r.close(),this.clearInterval()),this.hasPaid)&&setTimeout(()=>{location.href=d("/pagamento/confirmacao-do-pedido",{order:t})},5e3)}),document.addEventListener("beforeunload",()=>{r.readyState!==r.CLOSED&&(r.close(),this.clearInterval())})},patchOrder({pago:e,expired:t,total:r}){this.order&&(this.order.pago=e,this.order.total=r,this.order.expired=t)},async getOrder(e){var t="Falha ao capturar o pedido";try{var r=await fetch(i+`/confirm-pix/${e}/rest`,{headers:{Accept:"application/json"}});return r.ok?{data:await r.json(),succeeded:!0}:s((await r.json())?.message??t)}catch(e){return s(t)}},async handleCopyQRCode(){var e;this.hasCopied||(this.hasCopied=!0,navigator.clipboard.writeText?await navigator.clipboard.writeText(this.order?.qrcode_text??""):(e=document.createElement("input"),document.body.appendChild(e),e.value=this.order?.qrcode_text??"",e.select(),document.execCommand("copy"),document.body.removeChild(e)),setTimeout(()=>this.hasCopied=!1,3e3))},setQRImage(){var e=n("[data-wtf-qr-code-image]");e&&(e.onload=()=>{var e,t,r;e=!1,t=n("[data-wtf-loader]"),r="oculto",e=!e,t&&t.classList.toggle(r,e)},e.setAttribute("src",this.order?.qrcode??e.getAttribute("src")))},clearInterval(){clearInterval(this.nowInterval),this.nowInterval=a}},computed:{orderPrice(){return t.format(this.order?.total??0)},timmer(){var e;return!this.order||this.isExpired?o:(e=Math.floor(Math.max((this.order?.due_time??0)-this.now,0)/1e3),[Math.floor(e/3600),Math.floor(e%3600/60),e%60].map(e=>e.toString().padStart(2,"0")).join(":"))},hasPaid(){return this.order?.pago??!1},isExpired(){return this.order?.expired??!1},getQRCode(){return this.order?.qrcode_text??""}},watch:{timmer(e){e===o&&this.patchOrder({expired:!0,total:this.order?.total??0,pago:this.order?.pago??!1})}}}).mount(n("#pixProcess"))})();