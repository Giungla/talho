(()=>{let i="https://xef5-44zo-gegm.b2.xano.io/api:79PnTkh_",n={headers:{Accept:"application/json","Content-Type":"application/json"}},c=new Intl.NumberFormat("pt-BR",{currency:"BRL",style:"currency"}),o=new Proxy({cart:null,fetched:null,isPending:!1,isCartOpened:!0},{get(t,e){return"getOrderPrice"!==e?Reflect.get(t,e):c.format(t.cart?.order_price??0)},set(t,e,a){t=Reflect.set(t,e,a);if(t)switch(e){case"isPending":console.log("Alteração no estado de carregamento",a);break;case"isCartOpened":r();break;case"cart":(()=>{if(g(u,o.getOrderPrice),Array.isArray(o.cart?.items)&&s&&d){if(!((t,e,a)=>!!t&&t.classList.toggle(e,a))(l,"oculto",0<o.cart?.items.length))return d.replaceChildren();var t,e=document.createDocumentFragment();for(t of o.cart.items){var r=s.cloneNode(!0),i=(g(f("[data-wtf-floating-cart-item-product-name]",r),t.name),g(f("[data-wtf-floating-cart-item-quantity]",r),t.quantity.toString()),g(f("[data-wtf-floating-cart-item-product-price]",r),c.format(t.price)),document.createElement("img"));i.setAttribute("src",t.imageUrl),f("[data-wtf-floating-cart-item-image]",r)?.replaceChildren(i);let a={sku_id:t.sku_id,reference_id:t.slug};for(let[e,t]of[["delete","data-wtf-floating-cart-item-remove"],["increase","data-wtf-floating-cart-item-plus-button"],["decrease","data-wtf-floating-cart-item-minus-button"]])((t,e,a,r)=>{if(t)t.addEventListener(e,a,r)})(f(`[${t}]`,r),"click",t=>h.call(t,e,a));e.appendChild(r)}d.replaceChildren(e)}})()}return t}}),s=f("[data-wtf-floating-cart-item]"),d=f("[data-wtf-floating-cart-item-wrapper]"),l=f("[data-wtf-floating-cart-empty-cart]"),u=f("[data-wtf-floating-cart-total]");function f(t,e=document){return e?e.querySelector(t):null}function g(t,e){t&&(t.textContent=e)}function m(t){return{message:t,succeeded:!1}}function p(t){return{data:t,succeeded:!0}}async function r(){var t;o.isCartOpened&&(o.isPending=!0,t=await(async()=>{var e="Houve uma falha ao buscar o seu carrinho";try{var t=await fetch(i+"/cart/get",{...n,credentials:"include"});return t.ok?p(await t.json()):m((await t.json())?.message??e)}catch(t){return m(e)}})(),o.fetched??=!0,o.isPending=!0,t.succeeded)&&(o.cart=t.data,console.log("busca retornou sucesso",t.data))}async function a(t,e){o.isPending=!0;e=await(async(t,e)=>{var a="Houve uma falha ao buscar o seu carrinho";try{var r=await fetch(i+"/cart/handle",{...n,method:"POST",credentials:"include",body:JSON.stringify({item:t,operation:e})});return r.ok?p(await r.json()):m((await r.json())?.message??a)}catch(t){return m(a)}})({...e,quantity:1},t);o.isPending=!1,e.succeeded&&(o.cart=e.data)}async function h(t,e){this.preventDefault(),this.stopPropagation(),await a(t,e)}var t=f("[data-wtf-floating-cart]"),e=new MutationObserver(t=>{t=t[0].target;o.isCartOpened=t.checkVisibility({checkOpacity:!0,checkVisibilityCSS:!0,visibilityProperty:!0})});t&&(e.observe(t,{attributes:!0,attributeFilter:["style","class"]}),d)&&r().then(()=>{o.isCartOpened=!1})})();