(()=>{let i="oculto",n="talho_cart_items",c="https://xef5-44zo-gegm.b2.xano.io/api:79PnTkh_",o={headers:{Accept:"application/json","Content-Type":"application/json"}},s=new Intl.NumberFormat("pt-BR",{currency:"BRL",style:"currency"}),d=new Proxy({cart:null,fetched:null,isPending:!1,isCartOpened:!0},{get(t,e){switch(e){case"hasFreeShipping":return 300<(t.cart?.order_price??0);case"missingForFreeShipping":return Math.max(0,300-(t.cart?.order_price??0));case"getOrderPrice":return s.format(t.cart?.order_price??0);default:return Reflect.get(t,e)}},set(t,e,a){var r,t=Reflect.set(t,e,a);if(t)switch(e){case"isPending":console.log("Alteração no estado de carregamento",a);break;case"isCartOpened":O();break;case"cart":(()=>{if(w(p,d.getOrderPrice),Array.isArray(d.cart?.items)&&l&&u){if(!y(f,i,0<d.cart?.items.length))return u.replaceChildren();var t,e=document.createDocumentFragment();for(t of d.cart.items){var r=l.cloneNode(!0),n=(w(h("[data-wtf-floating-cart-item-product-name]",r),t.name),w(h("[data-wtf-floating-cart-item-quantity]",r),t.quantity.toString()),w(h("[data-wtf-floating-cart-item-product-price]",r),s.format(t.price)),document.createElement("img"));n.setAttribute("src",t.imageUrl),h("[data-wtf-floating-cart-item-image]",r)?.replaceChildren(n);let a={sku_id:t.sku_id,reference_id:t.slug};for(let[e,t]of[["delete","data-wtf-floating-cart-item-remove"],["increase","data-wtf-floating-cart-item-plus-button"],["decrease","data-wtf-floating-cart-item-minus-button"]])((t,e,a,r)=>{if(t)t.addEventListener(e,a,r)})(h(`[${t}]`,r),"click",t=>S.call(t,e,a));e.appendChild(r)}u.replaceChildren(e)}})(),r=d.hasFreeShipping,y(g,i,!r),y(m,i,r),r?w(h("[data-wtf-promo-validada-txt-sem-imagem]",g),"Você ganhou frete grátis"):w(h("[data-wtf-promo-invalidada-txt]",m),`Adiciona mais ${s.format(d.missingForFreeShipping)} para conseguir frete grátis`),localStorage.setItem(n,JSON.stringify(a))}return t}}),l=h("[data-wtf-floating-cart-item]"),u=h("[data-wtf-floating-cart-not-empty-cart]"),f=h("[data-wtf-floating-cart-empty-cart]"),g=h("[data-wtf-promo-valid]"),m=h("[data-wtf-promo-invalid]"),p=h("[data-wtf-floating-cart-total]");function h(t,e=document){return e?e.querySelector(t):null}function w(t,e){t&&(t.textContent=e)}function y(t,e,a){return t&&t.classList.toggle(e,a)}function v(t){return{message:t,succeeded:!1}}function b(t){return{data:t,succeeded:!0}}async function O(){var t;d.isCartOpened&&((t=localStorage.getItem(n))?(d.fetched??=!0,d.cart=JSON.parse(t)):(d.isPending=!0,t=await(async()=>{var e="Houve uma falha ao buscar o seu carrinho";try{var t=await fetch(c+"/cart/get",{...o,credentials:"include"});return t.ok?b(await t.json()):v((await t.json())?.message??e)}catch(t){return v(e)}})(),d.fetched??=!0,d.isPending=!1,t.succeeded&&(d.cart=t.data)))}async function a(t,e){d.isPending=!0;e=await(async(t,e)=>{var a="Houve uma falha ao buscar o seu carrinho";try{var r=await fetch(c+"/cart/handle",{...o,method:"POST",credentials:"include",body:JSON.stringify({item:t,operation:e})});return r.ok?b(await r.json()):v((await r.json())?.message??a)}catch(t){return v(a)}})({...e,quantity:1},t);d.isPending=!1,e.succeeded&&(d.cart=e.data)}async function S(t,e){this.preventDefault(),this.stopPropagation(),await a(t,e)}var t=h("[data-wtf-floating-cart]"),e=new MutationObserver(t=>{var e,t=t[0].target;d.isCartOpened=(e="carrinhoflutuante--visible",!!(t=t)&&t.classList.contains(e))});t&&(e.observe(t,{attributes:!0,attributeFilter:["class"]}),u)&&(window.addEventListener("storage",function(t){t.key===n&&(d.cart=t.newValue?JSON.parse(t.newValue):null)}),O().then(()=>{d.isCartOpened=!1}))})();