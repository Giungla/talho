!function(){"use strict";var e="__Host-Talho-Session-Cookie",t="X-Talho-Session";function o(o){const r=o?.headers.get(t);r&&function(e,t,o={}){if(0===d(e))throw new Error("'setCookie' should receive a valid cookie name");if(!["string","number","boolean"].includes(typeof t)||0===d(t.toString()))throw new Error("'setCookie' should receive a valid cookie value");const r=[`${e}=${t}`];o?.expires&&o?.expires instanceof Date&&r.push("expires="+o.expires.toUTCString()),o.maxAge&&r.push(`maxAge=${o.maxAge}`),o?.sameSite&&"string"==typeof o?.sameSite&&r.push(`SameSite=${o?.sameSite}`),o?.path&&r.push(`path=${o?.path}`),o?.domain&&r.push(`domain=${o?.path}`),o?.httpOnly&&r.push("HttpOnly"),o?.secure&&r.push("Secure");const a=r.join(h);document.cookie=a}(e,r,{path:"/",secure:!0,sameSite:"Strict",expires:new Date(Date.now()+1e3*p*90)})}function r(e){return o(this),this&&401===this.status&&(location.href=c("/acessos/entrar",{redirect_to:encodeURIComponent(location.pathname+location.search)})),{message:e,succeeded:!1}}function a(e){return o(this),{data:e,succeeded:!0}}function n(o=[],r="GET"){const a=new Headers({Accept:"application/json","Content-Type":"application/json"});for(const[e,t]of o)a.set(e,t);const n=u(e);n&&a.set(t,n);const i=u("__Host-Talho-AuthToken");return i&&a.set("Authorization",i),{method:r,headers:a}}var i=null;function s(e,t=document){return t?t.querySelector(e):i}function c(e,t={}){const o=new URL(`${location.protocol}//${location.hostname}`),r=new URL(e,o);for(const[a,n]of Object.entries(t))r.searchParams.set(a,n);return r.toString()}function d(e){return e.length}var h="; ";function u(e){const t=document.cookie.split(h).find(t=>{const{name:o}=l(t);return o===e});return!!t&&l(t).value}function l(e){const[t,o]=e.split("=");return{name:t,value:o}}var p=86400,m=new Intl.NumberFormat("pt-BR",{currency:"BRL",style:"currency"}),{createApp:f}=window.Vue,g="00:00:00",w="https://xef5-44zo-gegm.b2.xano.io/api:5lp3Lw8X",v="/pagamento/confirmacao-do-pedido";f({name:"PIXProcessPage",setup:()=>({hasEventSource:Vue.shallowRef(i)}),data:()=>({now:Date.now(),isLoading:!0,hasCopied:!1,order:i,nowInterval:i}),async created(){this.hasEventSource="EventSource"in window;const e=new URLSearchParams(location.search).get("order");if(!e)return void(location.href=c("/"));const t=await this.getOrder(e);if(t.succeeded&&"pix"===t.data.payment_method){if(this.isLoading=!1,this.order=t.data,Vue.nextTick(()=>this.setQRImage()),t.data.pago)setTimeout(()=>{location.href=c(v,{order:e})},5e3);else if(!t.data.expired)return this.nowInterval=setInterval(()=>this.now=Date.now(),1e3),this.hasEventSource?this.pollOrder(e):void 0}else location.href=c("/")},methods:{pollOrder(e){const t=new EventSource(`${w}/confirm-pix/${e}`);t.addEventListener("message",async o=>{const r=function(e){if("string"!=typeof e)return null;try{return JSON.parse(e)}catch{return i}}(o.data);r!==i&&(this.patchOrder({...r,expired:g===this.timmer||r.expired}),(this.hasPaid||this.isExpired)&&(t.readyState!==t.CLOSED&&t.close(),this.clearInterval()),this.hasPaid&&setTimeout(()=>{location.href=c(v,{order:e})},5e3))}),document.addEventListener("beforeunload",()=>{t.readyState!==t.CLOSED&&(t.close(),this.clearInterval())})},patchOrder({pago:e,expired:t,total:o}){this.order&&(this.order.pago=e,this.order.total=o,this.order.expired=t)},async getOrder(e){const t="Falha ao capturar o pedido";try{const o=await fetch(`${w}/confirm-pix/${e}/rest`,{...n()});if(!o.ok){const e=await o.json();return r.call(o,e?.message??t)}const i=await o.json();return a.call(o,i)}catch(o){return r(t)}},async handleCopyQRCode(){if(!this.hasCopied){if(this.hasCopied=!0,navigator.clipboard.writeText)await navigator.clipboard.writeText(this.order?.qrcode_text??"");else{const e=document.createElement("input");document.body.appendChild(e),e.value=this.order?.qrcode_text??"",e.select(),document.execCommand("copy"),document.body.removeChild(e)}setTimeout(()=>this.hasCopied=!1,3e3)}},setQRImage(){const e=s("[data-wtf-qr-code-image]");var t;e&&(e.onload=()=>{return!!(e=s("[data-wtf-loader]"))&&e.classList.toggle("oculto",!0);var e},function(e,t,o){e&&e.setAttribute("src",o)}(e,0,this.order?.qrcode??((t=e)?t.getAttribute("src"):i)))},clearInterval(){clearInterval(this.nowInterval),this.nowInterval=i}},computed:{orderPrice(){const{order:e}=this;return m.format(e?e.total/100:0)},timmer(){if(!this.order||this.isExpired)return g;const e=Math.floor(Math.max((this.order?.due_time??0)-this.now,0)/1e3);return[Math.floor(e/3600),Math.floor(e%3600/60),e%60].map(e=>e.toString().padStart(2,"0")).join(":")},hasPaid(){return this.order?.pago??!1},isExpired(){return this.order?.expired??!1},getQRCode(){return this.order?.qrcode_text??""}},watch:{timmer(e){e===g&&this.patchOrder({expired:!0,total:this.order?.total??0,pago:this.order?.pago??!1})}}}).mount(s("#pixProcess"))}();