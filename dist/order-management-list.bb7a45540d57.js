!function(){"use strict";var e="NOTSTARTED",t="PREPARED",a="PREPARING",r="DELIVERYREADY",n="COMPLETED";function s(e){const t=E(document.cookie,"; ").find(t=>{const{name:a}=o(t);return a===e});return!!t&&o(t).value}function o(e){const[t,a]=E(e,"=",2);return{name:t,value:a}}var i="__Host-Talho-Session-Cookie",c="X-Talho-Session",u={redirect_to:encodeURIComponent(location.pathname+location.search)},l={path:"/",secure:!0,sameSite:"Strict",expires:new Date(Date.now()+1e3*f*14)};function d(e){const t=e?.headers.get(c);t&&function(e,t,a={}){if(0===v(e))throw new Error("'setCookie' should receive a valid cookie name");if(!["string","number","boolean"].includes(typeof t)||0===v(t.toString()))throw new Error("'setCookie' should receive a valid cookie value");const r=[`${e}=${t}`];w(a?.expires&&a?.expires instanceof Date,r,"expires="+a.expires.toUTCString()),w(a.maxAge,r,`maxAge=${a.maxAge}`),w(a?.sameSite&&"string"==typeof a?.sameSite,r,`SameSite=${a?.sameSite}`),w(a?.path,r,`path=${a?.path}`),w(a?.domain,r,`domain=${a?.domain}`),w(a?.httpOnly,r,"HttpOnly"),w(a?.secure,r,"Secure");const n=r.join("; ");document.cookie=n}(i,t,l)}function m(e,t=!1,a){return d(this),t||this&&401===this.status&&function(e="/acessos/entrar",t=u){location.href=function(e,t={}){const a=new URL(`${location.protocol}//${location.hostname}`),r=new URL(e,a);for(const[n,s]of Object.entries(t))r.searchParams.set(n,s);return r.toString()}(e,t)}(),a?.(),{message:e,succeeded:!1}}function h(e,t){return d(this),t?.(),{data:e,succeeded:!0}}function p(e=[],t="GET"){const a="application/json",r=new Headers({Accept:a,"Content-Type":a});for(const[s,i]of e)r.set(s,i);const n=s(i);n&&r.set(c,n);const o=s("__Host-Talho-AuthToken");return o&&r.set("Authorization",o),{method:t,headers:r}}var f=86400,g=new Intl.NumberFormat("pt-BR",{currency:"BRL",style:"currency"});function v(e){return e.length}function E(e,t,a){return e.split(t,a)}function w(e,t,a){return e?t.push(a):-1}function A(e,t){return e===t}new Event("input"),new Event("blur"),document.currentScript?.getAttribute("data-parameter-names");var{createApp:S}=Vue;S({name:"OrderManagementApp",async created(){const e=await this.getOrders();e.succeeded&&(this.orders=e.data)},data:()=>({orders:null,activeFilter:null,availableFilters:[{label:"Não iniciado",name:e},{label:"Em preparação",name:a},{label:"Preparado",name:t},{label:"Pronto para entrega",name:r},{label:"Pedido entregue",name:n}]}),methods:{async getOrders(){const e="Houve uma falha com a busca de pedidos";try{const t=await fetch("https://xef5-44zo-gegm.b2.xano.io/api:YomXpzWs/order/list",{...p()});if(!t.ok){const a=await t.json();return m.call(t,a?.message??e)}const a=await t.json();return h.call(t,a)}catch(t){return m(e)}},applyFilter(e){A(this.activeFilter,e)||(this.activeFilter=e)},getFilterByToken(e){return this.getAppliableFilters.find(({name:t})=>A(t,e))}},computed:{hasOrders(){const{orders:e}=this;return Array.isArray(e)&&e.length>0},getParsedOrders(){if(!this.hasOrders)return[];const{orders:s,activeFilter:o}=this;return(null!==o?s.filter(({prepare_status:s,status:i})=>{switch(o){case"ASSIGNING_DRIVER":case"CANCELED":case"ON_GOING":case"PICKED_UP":case"REJECTED":case"EXPIRED":case n:return A(i,o);case e:case a:case t:case r:return!A(i,n)&&A(s,o)}}):s).map(({total:e,transaction_id:t,created_at:a,order_items:r,prepare_status:s,status:o,...i})=>{const c=o===n?o:s;return{...i,created_date:(u=a,new Date(u).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),items_count:r,price:g.format(e/100),url:`/adm/ficha-de-pedido?transactionid=${t}`,...c&&{delivery_status:this.getFilterByToken(c)}};var u})??[]},getAppliableFilters(){if(!this.hasOrders)return[];const{getAvailableStatus:e}=this;return this.availableFilters.reduce((t,a)=>e.includes(a.name)?t.concat({...a,className:a.name?.toLowerCase(),name:a.name}):t,[])},getAvailableStatus(){if(!this.hasOrders)return[];const e=[];for(const{prepare_status:t,status:a}of this.orders)w(!e.includes(t),e,t),w(a&&!e.includes(a),e,a);return e}}}).mount("#order-management-list"),window.addEventListener("pageshow",e=>{e.persisted&&window.location.reload()})}();