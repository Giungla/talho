"use strict";(()=>{(function(){let d="oculto",J="__Host-Talho-AuthToken",Z="mensagemdeerro",D="https://xef5-44zo-gegm.b2.xano.io";function a(e,t=document){return t.querySelector(e)}function p(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function h(e,t,n){return e.split(t,n)}function W(e){let t=h(document.cookie,"; ").find(n=>{let{name:r}=x(n);return r===e});return t?x(t).value:!1}function x(e){let[t,n]=h(e,"=");return{name:t,value:n}}function X(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function O(e,t){e&&e.removeAttribute(t)}function Q(e,t){return e.hasOwnProperty(t)}function M(e,...t){e&&e.classList.add(...t)}function F(e,...t){e&&e.classList.remove(...t)}function S(e,t,n){return e?e.classList.toggle(t,n):!1}function k(e){return{data:e,succeeded:!0}}function w(e){return{message:e,succeeded:!1}}function Y(e,t){let n=!t.succeeded,r=a("[data-wtf-user-update-error-message]",e),i=a("[data-wtf-user-update-success-message]",e);if(S(r,d,!n),S(i,d,n),!n){setTimeout(()=>M(i,d),8e3);return}let s=r&&a("div",r);s&&(s.textContent=t.message)}function A(){window.location.href=`/acessos/entrar?redirect_to=${encodeURIComponent(location.pathname)}`}function m(e,t){e&&(S(e,d,!t),e.textContent=t??"")}function R(e){Object.assign(g,e),ue()}let g=new Proxy({cpf:"",name:"",email:"",birthday:"",telephone:"",isFormVisible:!1},{get(e,t){let n=Reflect.get(e,t);switch(t){case"fullName":return`${e?.name} ${e?.last_name}`;default:return n}},set(e,t,n,r){let i=Reflect.set(e,t,n);switch(t){case"name":case"last_name":m(ne,r?.fullName??"");break;case"birthday":m(oe,n);break;case"telephone":m(ae,n);break;case"cpf":m(se,n);break;case"email":m(re,n);break;case"points":m(te,n);break}return i}}),N=W(J),U={Accept:"application/json","Content-Type":"application/json",...N&&{Authorization:N}},ee=["name","method","data-name","aria-label","data-wf-page-id","data-wf-element-id","data-turnstile-sitekey"],v=a("#wf-form-update-user-data");if(v){for(let n of ee)O(v,n);let e=v.parentElement,t=a('[type="submit"]',v);O(t,"disabled"),F(e,"w-form"),v.remove(),e.insertAdjacentHTML("beforeend",v.outerHTML)}let P=a("#wf-form-update-user-data");p(P,"submit",async e=>{e.preventDefault(),e.stopPropagation();let t=Q(P,"cpf"),n=[z,q,V,G];t&&n.splice(2,0,B);let r=n.find(f=>f().at(1)===!1);if(r){let f=X(r().at(0));a(`[data-${f}]`,P)?.focus({preventScroll:!1});return}let s={birthday:h(c?.value??"","/").reverse().join("-"),cpf:o?.value,name:y?.value,telephone:u?.value,last_name:E?.value};t&&Object.assign(s,{cpf:o?.value});let l=await me(s);Y(P,l),l.succeeded&&(window?.refreshOrders?.(),R(l.data))});let te=a("[data-wtf-score]"),ne=a("[data-wtf-name]"),re=a("[data-wtf-email]"),ae=a("[data-wtf-phone]"),se=a("[data-wtf-cpf]"),oe=a("[data-wtf-birthday]"),y=a("[data-wtf-name-update]"),E=a("[data-wtf-last-name-update]"),u=a("[data-wtf-phone-update]"),o=a("[data-wtf-cpf-update]"),c=a("[data-wtf-birthday-update]"),$=a("[data-wtf-edit-account-data]"),H=a("[data-wtf-update-account-data]"),ie=[{field:y,validator:z},{field:E,validator:q},{field:o,validator:B},{field:u,validator:V},{field:c,validator:G}];for(let{field:e,validator:t}of ie)e&&(p(e,"blur",t),p(e,"input",()=>T(e,!0)));u&&p(u,"input",()=>{u.value=de(u.value)}),o&&p(o,"input",()=>{o.value=le(o.value)}),c&&p(c,"input",()=>{c.value=fe(c.value)});function ue(){if(!$)return;p($,"click",()=>{F(H,d),M($,d)},{once:!0});let e=[[o,g.cpf],[y,g.name],[c,g.birthday],[u,g.telephone],[E,g.last_name]];for(let[t,n]of e)ce(t,n);F($,d),M(H,d)}function ce(e,t){!e||e.tagName!=="INPUT"||(e.value=t??"")}function I(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function de(e){let{cleaned:t,size:n}=L(e);return n===0?t:n>0&&n<3?t.replace(/(\d{0,2})/,"($1"):n<7?t.replace(/(\d{2})(\d{0,4})/,"($1) $2"):n<=10?t.replace(/(\d{2})(\d{4})(\d{1,4})/,"($1) $2-$3"):t.replace(/(\d{2})(\d{5})(\d{4})/,"($1) $2-$3")}function le(e){let{cleaned:t,size:n}=L(e);return n<4?t:n<7?t.replace(/(\d{3})(\d{1,3})/,"$1.$2"):n<=9?t.replace(/(\d{3})(\d{3})(\d{1,3})/,"$1.$2.$3"):t.replace(/(\d{3})(\d{3})(\d{3})(\d{1,2})/,"$1.$2.$3-$4")}function fe(e){let{cleaned:t,size:n}=L(e);return n<3?t:n<5?t.replace(/(\d{2})(\d{1,2})/,"$1/$2"):t.replace(/(\d{2})(\d{2})(\d{1,4})/,"$1/$2/$3")}function L(e){let t=K(e);return{cleaned:t,size:C(t)}}function _(e){return e.trim().replace(/\s+/g," ")}function C(e){return e.length}function K(e){return e.replace(/\D/g,"")}function b(e){return function(t){return[e,t]}}function T(e,t){let n=e.closest("[data-wtf-wrapper]");S(n,Z,!t)}function j(e){return/^[a-zA-Z\s]+$/.test(e)}function z(){let e=b("wtfNameUpdate");if(!y)return e(!1);let t=_(I(y.value)),n=C(t)>1&&j(t);return T(y,n),e(n)}function q(){let e=b("wtfLastNameUpdate");if(!E)return e(!1);let t=_(I(E.value)),n=C(t)>0&&j(t);return T(E,n),e(n)}function B(){let e=b("wtfCpfUpdate");if(!o)return e(!1);let t=/^\d{3}\.\d{3}\.\d{3}-\d{2}$/.test(o.value)&&pe(o.value);return T(o,t),e(t)}function V(){let e=b("wtfPhoneUpdate");if(!u)return e(!1);let t=/^\(\d{2}\)\s\d{4,5}-\d{4}$/.test(u.value);return T(u,t),e(t)}function G(){let e=b("wtfBirthdayUpdate");if(!c)return e(!1);let t=c.value,n=/^(\d{2})\/(\d{2})\/(19|20)(\d{2})$/g.test(t),[r,i,s]=h(t,"/"),l=new Date(`${s}-${i}-${r}T00:00:00.000Z`).getTime(),f=n&&!isNaN(l)&&Date.now()>l;return T(c,f),e(f)}function pe(e){if(e=K(e),C(e)!==11||/^(\d)\1{10}$/.test(e))return!1;let t=!0;return[9,10].forEach(function(r){let i=0,s;h(e,"").splice(0,r).forEach(function(l,f){i+=parseInt(l)*(r+2-(f+1))}),s=i%11,s=s<2?0:11-s,s!==parseInt(e.substring(r,r+1))&&(t=!1)}),t}async function me(e){let t="Houve uma falha ao salvar seus dados. Tente novamente mais tarde.";try{let n=await fetch(`${D}/api:TJEuMepe/user/edit`,{method:"PUT",headers:U,body:JSON.stringify(e)});if(!n.ok){let i=await n.json();return n.status===401&&A(),w(i?.message??t)}let r=await n.json();return k(r)}catch{return w(t)}}async function ge(){let e="Houve uma falha ao carregar seus dados. Tente novamente mais tarde.";try{let t=await fetch(`${D}/api:TJEuMepe/user/get`,{headers:U});if(!t.ok){let r=await t.json();return t.status===401&&A(),w(r?.message??e)}let n=await t.json();return k(n)}catch{return w(e)}}ge().then(e=>{e.succeeded&&R(e.data)})})();})();
