!function(){"use strict";var e="COMPLETED",t="CANCELED",r="__Host-Talho-Session-Cookie",n="X-Talho-Session",a={redirect_to:encodeURIComponent(location.pathname+location.search)},s={path:"/",secure:!0,sameSite:"Strict",expires:new Date(Date.now()+12096e5)};function i(e){const t=e?.headers.get(n);t&&function(e,t,r={}){if(0===v(e))throw new Error("'setCookie' should receive a valid cookie name");if(!["string","number","boolean"].includes(typeof t)||0===v(t.toString()))throw new Error("'setCookie' should receive a valid cookie value");const n=[`${e}=${encodeURIComponent(t)}`];h(r?.expires&&r?.expires instanceof Date,n,"expires="+r.expires?.toUTCString()),h(r.maxAge,n,`maxAge=${r.maxAge}`),h(r?.sameSite&&"string"==typeof r?.sameSite,n,`SameSite=${r?.sameSite}`),h(r?.path,n,`path=${r?.path}`),h(r?.domain,n,`domain=${r?.domain}`),h(r?.httpOnly,n,"HttpOnly"),h(r?.secure,n,"Secure");const a=n.join(f);document.cookie=a}(r,t,s)}function o(e,t=!1,r){return i(this),t||this&&401===this.status&&function(e="/acessos/entrar",t=a){location.href=function(e,t={}){const r=new URL(`${location.protocol}//${location.hostname}`),n=new URL(e,r);for(const[a,s]of Object.entries(t))n.searchParams.set(a,s);return n.toString()}(e,t)}(),r?.(),{message:e,succeeded:!1}}function c(e,t){return i(this),t?.(),{data:e,succeeded:!0}}function u(e=[],t="GET"){const a="application/json",s=new Headers({Accept:a,"Content-Type":a});for(const[r,n]of e)s.set(r,n);const i=p(r);i&&s.set(n,i);const o=p("__Host-Talho-AuthToken");return o&&s.set("Authorization",o),{method:t,headers:s}}var d=new Intl.NumberFormat("pt-BR",{currency:"BRL",style:"currency"});function h(e,t,r){return e?t.push(r):-1}function l(e,t){return e.includes(t)}var m=new WeakMap;new Event("input"),new Event("blur"),document.currentScript?.getAttribute("data-parameter-names");var f="; ";function p(e){const t=D((r=document.cookie,r.replace(/\s{2,}/g," ")),f).find(t=>{const{name:r}=g(t);return r===e});var r;return!!t&&g(t).value}function g(e){const[t,...r]=D(e,"=");return{name:t,value:v(r)>0&&decodeURIComponent(r.join("="))}}var w=null;function v(e){return e.length}function D(e,t,r){return e.split(t,r)}function y(e){return e===w}var{nextTick:P,createApp:b}=Vue;function R(e){return!e||0===v(e)}function S(e){return R(e)?w:function(e,t={}){return new Date(e).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit",...t})}(e,{timeZone:"UTC"})}function E(e){return R(e)?w:e}var T=b({name:"OrderManagementApp",async created(){this.refreshURLState=function(e,t,r){const n=(a=function(e){return new URL(window.location.href).searchParams.get(e)}(e))?function(e){if("string"!=typeof e)return null;try{return JSON.parse(e)}catch{return w}}(decodeURIComponent(atob(a))):null;var a;return n!==w&&r(n),()=>{const r=function(e){return btoa(encodeURIComponent(function(e){return JSON.stringify(e)}(e)))}(t()),n=function(e,t){const r=new URL(window.location.href);return t?r.searchParams.set(e,t):r.searchParams.delete(e),r.pathname+r.search}(e,r);history.replaceState(w,"",n)}}("filter",()=>this.filter,e=>this.filter=e),this.refresh(!1)},data:()=>({orders:w,availableFilters:[{label:"Não iniciado",name:"NOTSTARTED"},{label:"Em preparação",name:"PREPARING"},{label:"Preparado",name:"PREPARED"},{label:"Pronto para entrega",name:"DELIVERYREADY"},{label:"Pedido entregue",name:e},{label:"Cancelado",name:t}],refreshURLState:w,filter:{page:1,status:w,endDate:w,startDate:w}}),methods:{async getOrders(){const e="Houve uma falha com a busca de pedidos";try{const t=await fetch(`https://xef5-44zo-gegm.b2.xano.io/api:YomXpzWs/order/list${this.getFilteringQueryParams}`,{...u()});if(!t.ok){const r=await t.json();return o.call(t,r?.message??e)}const r=await t.json();return c.call(t,r)}catch(t){return o(e)}},getFilterByToken(e){return this.getAppliableFilters.find(({name:t})=>t===e)},async refresh(e=!0){const t=await this.getOrders();t.succeeded&&(this.orders=t.data,await P(()=>{var t,r;r={block:"start",behavior:"smooth"},(t=k)&&t.scrollIntoView(r),e&&this.refreshURLState?.()}))},async handlePaginate(e){this.filter.page=e,this.refresh()},async handleStatus(e){this.filter={...this.filter,page:1,status:e},this.refresh()}},computed:{hasOrders(){const{orders:e}=this,t=e?.itemsReceived;return"number"==typeof t&&t>0},getParsedOrders(){return this.hasOrders?this.orders?.items.map(({total:r,transaction_id:n,created_at:a,order_items:s,prepare_status:i,status:o,...c})=>{const u=l([e,t],o)?o:i;return{...c,created_date:(h=a,new Date(h).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),items_count:s,price:d.format(r/100),url:`/adm/ficha-de-pedido?transactionid=${n}`,...u&&{delivery_status:this.getFilterByToken(u)}};var h}):[]},getAppliableFilters(){return this.availableFilters.map(({name:e,...t})=>({...t,name:e,className:e?.toLowerCase()}),[])},hasPrevPage(){return!y(this.orders?.prevPage)},hasNextPage(){return!y(this.orders?.nextPage)},hasLastPage(){const e=this.orders;return l([e?.nextPage,e?.curPage],e?.pageTotal)},hasFirstPage(){const e=this.orders?.curPage;return"number"==typeof e&&e>2},getFilteringQueryParams(){const e=this.filter,t=[];for(const[r,n]of Object.entries(e))switch(r){case"page":h(!0,t,[r,n].join("="));break;case"status":h(!y(n),t,[r,n].join("="));break;case"endDate":h(!R(n),t,["final_date",n].join("="));break;case"startDate":h(!R(n),t,["start_date",n].join("="))}return"?"+t.join("&")},endDate:{get(){return S(this.filter.endDate)},set(e){this.filter.endDate=E(e),this.hasReversedDates?this.filter.endDate=w:this.handlePaginate(1)}},startDate:{get(){return S(this.filter.startDate)},set(e){this.filter.startDate=E(e),this.hasReversedDates?this.filter.startDate=w:this.handlePaginate(1)}},hasReversedDates(){const{endDate:e,startDate:t}=this.filter;if(R(e)||R(t))return!1;const r=new Date(`${e}T23:59:59`);return new Date(`${t}T00:00:00`).getTime()>r.getTime()}},directives:{showPickerOnFocus:{mounted(e){const t=function(e,t,r,n){if(e)return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r,n)}(e,"focus",()=>{try{e.showPicker()}catch(t){}});m.set(e,t)},unmounted:e=>{const t=m.get(e);t&&(t(),m.delete(e))}}}}),k=function(e,t=document){return t?t.querySelector(e):w}("#order-management-list");T.mount(k),window.addEventListener("pageshow",e=>{e.persisted&&window.location.reload()})}();