!function(){"use strict";var e="NOTSTARTED",t="PREPARED",r="PREPARING",s="DELIVERYREADY",o="COMPLETED",a="CANCELED",n="__Host-Talho-Session-Cookie",i="X-Talho-Session",c={redirect_to:encodeURIComponent(location.pathname+location.search)},d={path:"/",secure:!0,sameSite:"Strict",expires:new Date(Date.now()+12096e5)};function u(e){const t=e?.headers.get(i);t&&function(e,t,r={}){if(0===S(e))throw new Error("'setCookie' should receive a valid cookie name");if(!["string","number","boolean"].includes(typeof t)||0===S(t.toString()))throw new Error("'setCookie' should receive a valid cookie value");const s=[`${e}=${encodeURIComponent(t)}`];m(r?.expires&&r?.expires instanceof Date,s,"expires="+r.expires?.toUTCString()),m(r.maxAge,s,`maxAge=${r.maxAge}`),m(r?.sameSite&&"string"==typeof r?.sameSite,s,`SameSite=${r?.sameSite}`),m(r?.path,s,`path=${r?.path}`),m(r?.domain,s,`domain=${r?.domain}`),m(r?.httpOnly,s,"HttpOnly"),m(r?.secure,s,"Secure");const o=s.join(g);document.cookie=o}(n,t,d)}function p(e,t=!1,r){return u(this),t||this&&401===this.status&&function(e="/acessos/entrar",t=c){location.href=function(e,t={}){const r=new URL(`${location.protocol}//${location.hostname}`),s=new URL(e,r);for(const[o,a]of Object.entries(t))s.searchParams.set(o,a);return s.toString()}(e,t)}(),r?.(),{message:e,succeeded:!1}}function h(e,t){return u(this),t?.(),{data:e,succeeded:!0}}function l(e=[],t="GET"){const r="application/json",s=new Headers({Accept:r,"Content-Type":r});for(const[n,i]of e)s.set(n,i);const o=_(n);o&&s.set(i,o);const a=_("__Host-Talho-AuthToken");return a&&s.set("Authorization",a),{method:t,headers:s}}function m(e,t,r){return e?t.push(r):-1}function f(e,t){return m(!0,e,t)}new Event("input"),new Event("blur"),document.currentScript?.getAttribute("data-parameter-names");var g="; ";function _(e){const t=w((r=document.cookie,r.replace(/\s{2,}/g," ")),g).find(t=>{const{name:r}=y(t);return r===e});var r;return!!t&&y(t).value}function y(e){const[t,...r]=w(e,"=");return{name:t,value:S(r)>0&&decodeURIComponent(r.join("="))}}var v=null;function S(e){return e.length}function w(e,t,r){return e.split(t,r)}function T(e){return e===v}var{createApp:O}=Vue,b="transactionid",P="pix",A="creditcard",E={[P]:"PIX",[A]:"Cartão de crédito"},x="https://xef5-44zo-gegm.b2.xano.io/api:YomXpzWs";function C(e){return{filterKey:e,label:$[e]}}var $={[e]:"Não iniciado",[r]:"Pedido em preparação",[t]:"Pedido preparado",[s]:"Pedido pronto para entrega",[a]:"Pedido cancelado",[o]:"Pedido entregue"};O({name:"TalhoOrderNoteApp",data:()=>({order:v,messageTimer:v,prepareMessage:v,prepare_status:{selected:e,current:v}}),async created(){const e=new URLSearchParams(location.search).get(b);if(!e)return;const t=await this.getOrder(e);t.succeeded&&(this.order=t.data,this.syncOrderStatuses())},methods:{async getOrder(e){const t="Não foi possível encontrar o pedido";try{const r=await fetch(`${x}/order/delivery-prepare?${b}=${e}`,{...l()});if(!r.ok){const e=await r.json();return p.call(r,e?.message??t)}const s=await r.json();return h.call(r,s)}catch(r){return p(t)}},async handleOrderStatus(){this.messageTimer&&this.clearMessage();const e=this.order,{prepare_status:t}=this;if(!e||!t)return;const r=await this.setOrderStatus(e.order.number,t.selected);if(!r.succeeded)return this.prepare_status.current=this.finalOrderStatus,this.prepare_status.selected=this.finalOrderStatus,this.prepareMessage=r.message,void(this.messageTimer=setTimeout(this.clearMessage,5e3));const{status:s,prepare_status:o}=r.data;this.order={...e,order:{...e.order,status:s,prepare_status:o}},this.prepare_status.current=this.finalOrderStatus,this.prepareMessage="Modificado com sucesso",this.messageTimer=setTimeout(this.clearMessage,5e3)},async setOrderStatus(e,t){const r="Não foi possível alterar o status de preparação";try{const o=await fetch(`${x}/order/delivery-status`,{...l([],"PATCH"),body:(s={order_id:e,prepare_status:t},JSON.stringify(s))});if(!o.ok){const e=await o.json();return p.call(o,e?.message??r)}const a=await o.json();return h.call(o,a)}catch(o){return p(r)}var s},printPage(){window.print()},clearMessage(){T(this.messageTimer)||(clearTimeout(this.messageTimer),this.messageTimer=v),this.prepareMessage=v},syncOrderStatuses(){this.prepare_status.selected=this.finalOrderStatus,this.prepare_status.current=this.finalOrderStatus}},computed:{finalOrderStatus:{get(){const t=this.order?.order??v;if(T(t))return e;const{status:r,prepare_status:s}=t;return T(r)?s:r},set(e){this.prepare_status=e}},company(){return this.order?.company??v},customer(){return this.order?.customer??v},items(){return this.order?.items??v},itemsCount(){return S(this.items??[])},cOrder(){if(!this.order)return v;const{date:e,time:t,total:r,number:s,shipping:o,subtotal:a,discounts:n,change_for:i,notes_short:c,observations:d,payment_method:u,has_free_shipping:p}=this.order.order;return{date:e,time:t,total:r,number:s,shipping:o,subtotal:a,discounts:n,change_for:i,notes_short:c,observations:d,has_free_shipping:p,payment_method:E?.[u]}},deliveryDate(){if(!this.order)return v;const{order:e}=this.order;return`${e.delivery_date} ${e.delivery_hour}`},priorityTax(){const e=this.order?.order;return e&&e.has_priority?e?.priority_price:v},subsidyDiscount(){const e=this.order?.order;return e&&e.has_subsidy?e?.subsidy_price:v},pixDiscount(){const e=this.order?.order;return e&&"pix"===e.payment_method?{discountPrice:e.pix_discount_price,discountPercentual:e.pix_discount_percentual}:v},hasPaid(){return this.order?.order.paid??!1},deliveredAt(){return this.order?.order.delivered_at??v},getAvailableFilterChangeOptions(){const n=this.order;if(!n)return[];const{status:i,prepare_status:c}=n.order,d=[r,t,s,o,a],u=[];m(!T(i)&&i===a||c===e,u,C(e));for(const e of d)f(u,C(e));return u}}}).mount("#note-order"),window.addEventListener("pageshow",e=>{e.persisted&&window.location.reload()})}();