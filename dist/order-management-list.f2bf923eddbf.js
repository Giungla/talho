!function(){"use strict";var e="COMPLETED",t="__Host-Talho-Session-Cookie",r="X-Talho-Session",n={redirect_to:encodeURIComponent(location.pathname+location.search)},a={path:"/",secure:!0,sameSite:"Strict",expires:new Date(Date.now()+12096e5)};function s(e){const n=e?.headers.get(r);n&&function(e,t,r={}){if(0===g(e))throw new Error("'setCookie' should receive a valid cookie name");if(!["string","number","boolean"].includes(typeof t)||0===g(t.toString()))throw new Error("'setCookie' should receive a valid cookie value");const n=[`${e}=${encodeURIComponent(t)}`];d(r?.expires&&r?.expires instanceof Date,n,"expires="+r.expires?.toUTCString()),d(r.maxAge,n,`maxAge=${r.maxAge}`),d(r?.sameSite&&"string"==typeof r?.sameSite,n,`SameSite=${r?.sameSite}`),d(r?.path,n,`path=${r?.path}`),d(r?.domain,n,`domain=${r?.domain}`),d(r?.httpOnly,n,"HttpOnly"),d(r?.secure,n,"Secure");const a=n.join(l);document.cookie=a}(t,n,a)}function i(e,t=!1,r){return s(this),t||this&&401===this.status&&function(e="/acessos/entrar",t=n){location.href=function(e,t={}){const r=new URL(`${location.protocol}//${location.hostname}`),n=new URL(e,r);for(const[a,s]of Object.entries(t))n.searchParams.set(a,s);return n.toString()}(e,t)}(),r?.(),{message:e,succeeded:!1}}function o(e,t){return s(this),t?.(),{data:e,succeeded:!0}}function c(e=[],n="GET"){const a="application/json",s=new Headers({Accept:a,"Content-Type":a});for(const[t,r]of e)s.set(t,r);const i=m(t);i&&s.set(r,i);const o=m("__Host-Talho-AuthToken");return o&&s.set("Authorization",o),{method:n,headers:s}}var u=new Intl.NumberFormat("pt-BR",{currency:"BRL",style:"currency"});function d(e,t,r){return e?t.push(r):-1}var h=new WeakMap;new Event("input"),new Event("blur"),document.currentScript?.getAttribute("data-parameter-names");var l="; ";function m(e){const t=w((r=document.cookie,r.replace(/\s{2,}/g," ")),l).find(t=>{const{name:r}=f(t);return r===e});var r;return!!t&&f(t).value}function f(e){const[t,...r]=w(e,"=");return{name:t,value:g(r)>0&&decodeURIComponent(r.join("="))}}var p=null;function g(e){return e.length}function w(e,t,r){return e.split(t,r)}function v(e){return e===p}var{nextTick:y,createApp:D}=Vue;function P(e){return!e||0===g(e)}function b(e){return P(e)?p:function(e,t={}){return new Date(e).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit",...t})}(e,{timeZone:"UTC"})}function R(e){return P(e)?p:e}var S=D({name:"OrderManagementApp",async created(){this.refreshURLState=function(e,t,r){const n=(a=function(e){return new URL(window.location.href).searchParams.get(e)}(e))?function(e){if("string"!=typeof e)return null;try{return JSON.parse(e)}catch{return p}}(decodeURIComponent(atob(a))):null;var a;return n!==p&&r(n),()=>{const r=function(e){return btoa(encodeURIComponent(function(e){return JSON.stringify(e)}(e)))}(t()),n=function(e,t){const r=new URL(window.location.href);return t?r.searchParams.set(e,t):r.searchParams.delete(e),r.pathname+r.search}(e,r);history.replaceState(p,"",n)}}("filter",()=>this.filter,e=>this.filter=e),this.refresh(!1)},data:()=>({orders:p,availableFilters:[{label:"Não iniciado",name:"NOTSTARTED"},{label:"Em preparação",name:"PREPARING"},{label:"Preparado",name:"PREPARED"},{label:"Pronto para entrega",name:"DELIVERYREADY"},{label:"Pedido entregue",name:e}],refreshURLState:p,filter:{page:1,status:p,endDate:p,startDate:p}}),methods:{async getOrders(){const e="Houve uma falha com a busca de pedidos";try{const t=await fetch(`https://xef5-44zo-gegm.b2.xano.io/api:YomXpzWs/order/list${this.getFilteringQueryParams}`,{...c()});if(!t.ok){const r=await t.json();return i.call(t,r?.message??e)}const r=await t.json();return o.call(t,r)}catch(t){return i(e)}},getFilterByToken(e){return this.getAppliableFilters.find(({name:t})=>t===e)},async refresh(e=!0){const t=await this.getOrders();t.succeeded&&(this.orders=t.data,await y(()=>{var t,r;r={block:"start",behavior:"smooth"},(t=T)&&t.scrollIntoView(r),e&&this.refreshURLState?.()}))},async handlePaginate(e){this.filter.page=e,this.refresh()},async handleStatus(e){this.filter={...this.filter,page:1,status:e},this.refresh()}},computed:{hasOrders(){const{orders:e}=this,t=e?.itemsReceived;return"number"==typeof t&&t>0},getParsedOrders(){return this.hasOrders?this.orders?.items.map(({total:t,transaction_id:r,created_at:n,order_items:a,prepare_status:s,status:i,...o})=>{const c=i===e?i:s;return{...o,created_date:(d=n,new Date(d).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),items_count:a,price:u.format(t/100),url:`/adm/ficha-de-pedido?transactionid=${r}`,...c&&{delivery_status:this.getFilterByToken(c)}};var d}):[]},getAppliableFilters(){return this.availableFilters.map(({name:e,...t})=>({...t,name:e,className:e?.toLowerCase()}),[])},hasPrevPage(){return!v(this.orders?.prevPage)},hasNextPage(){return!v(this.orders?.nextPage)},hasLastPage(){const e=this.orders;return t=[e?.nextPage,e?.curPage],r=e?.pageTotal,t.includes(r);var t,r},hasFirstPage(){const e=this.orders?.curPage;return"number"==typeof e&&e>2},getFilteringQueryParams(){const e=this.filter,t=[];for(const[r,n]of Object.entries(e))switch(r){case"page":d(!0,t,[r,n].join("="));break;case"status":d(!v(n),t,[r,n].join("="));break;case"endDate":d(!P(n),t,["final_date",n].join("="));break;case"startDate":d(!P(n),t,["start_date",n].join("="))}return"?"+t.join("&")},endDate:{get(){return b(this.filter.endDate)},set(e){this.filter.endDate=R(e),this.hasReversedDates?this.filter.endDate=p:this.handlePaginate(1)}},startDate:{get(){return b(this.filter.startDate)},set(e){this.filter.startDate=R(e),this.hasReversedDates?this.filter.startDate=p:this.handlePaginate(1)}},hasReversedDates(){const{endDate:e,startDate:t}=this.filter;if(P(e)||P(t))return!1;const r=new Date(`${e}T23:59:59`);return new Date(`${t}T00:00:00`).getTime()>r.getTime()}},directives:{showPickerOnFocus:{mounted(e){const t=function(e,t,r,n){if(e)return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r,n)}(e,"focus",()=>{try{e.showPicker()}catch(t){}});h.set(e,t)},unmounted:e=>{const t=h.get(e);t&&(t(),h.delete(e))}}}}),T=function(e,t=document){return t?t.querySelector(e):p}("#order-management-list");S.mount(T),window.addEventListener("pageshow",e=>{e.persisted&&window.location.reload()})}();